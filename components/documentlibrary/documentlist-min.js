(function(){var B=YAHOO.util.Dom,P=YAHOO.util.Event,N=YAHOO.util.DragDropMgr;var f=Alfresco.util.encodeHTML,al=Alfresco.util.activateLinks,aJ=Alfresco.util.combinePaths,o=Alfresco.util.userProfileLink,b=Alfresco.util.siteURL,O=function O(a3,a4){return Alfresco.util.formatDate(Alfresco.util.fromISO8601(a3),a4)},ac=Alfresco.util.relativeTime,G=Alfresco.util.isValueSet;var aV="org.alfresco.share.documentList",aF=aV+".sortAscending",d=aV+".sortField",Z=aV+".showFolders",F=aV+".hideNavBar",T=aV+".simpleView",aa=aV+".viewRendererName",av=aV+".galleryColumns";Alfresco.DnD=function(a7,a4,a3,a5){Alfresco.DnD.superclass.constructor.call(this,a7,a3,a5);var a6=this.getDragEl();B.setStyle(a6,"opacity",0.67);this.docLib=a4};YAHOO.extend(Alfresco.DnD,YAHOO.util.DDProxy,{_inFlight:false,startDrag:function q(a4,a7){var a3=this.getDragEl();var a6=this.getEl();B.setStyle(a6,"visibility","hidden");var a5=document.createElement("img");a5.src=a6.src;a3.removeChild(a3.firstChild);a3.appendChild(a5);B.setStyle(a3,"border","none")},endDrag:function aj(a5){if(!this._inFlight){var a3=this.getEl();var a4=this.getDragEl();this.animateResult(a4,a3)}},animateResult:function ar(a6,a3){B.setStyle(a6,"visibility","");var a4=new YAHOO.util.Motion(a6,{points:{to:B.getXY(a3)}},0.2,YAHOO.util.Easing.easeOut);var a5=a6.id;var a7=this.id;a4.onComplete.subscribe(function(){B.setStyle(a5,"visibility","hidden");B.setStyle(a7,"visibility","")});a4.animate()},onDragDrop:function u(a7,a9){var a8=B.get(a9);if(N.interactionInfo.drop.length>0){if(B.isAncestor(this.docLib.widgets.dataTable.getContainerEl(),a8)){var a3=this.docLib.widgets.dataTable.getRecord(B.get(a9)),a6=a3.getData();if(a6.node.isContainer){this._inFlight=true;var a4;if(a6.node.isLink){a4=new Alfresco.util.NodeRef(a6.node.linkedNode.nodeRef)}else{a4=new Alfresco.util.NodeRef(a6.node.nodeRef)}this._performMove(a4,a6.location.path+"/"+a6.location.file)}}else{if(B.hasClass(a8,"documentDroppable")){var a5={elementId:a9,callback:this.onDropTargetOwnerCallBack,scope:this};this._inFlight=true;YAHOO.Bubbling.fire("dropTargetOwnerRequest",a5);this._setFailureTimeout()}}}},_performMove:function aq(a8,bb){var a5=this.docLib.widgets.dataTable.getRecord(this.getEl()),a6="move-to/node/{nodeRef}",ba=[];ba.push(this.getEl().id);var a9=function a7(be){this._inFlight=false;var bc,bf=be.json.successCount,bg=be.json.failureCount;if(!be.json.overallSuccess){this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});B.removeClass(this.dragFolderHighlight,"dndFolderHighlight");return}this.docLib._updateDocList.call(this.docLib);var bd=a5.getData();if(bd.node.isContainer){YAHOO.Bubbling.fire("folderMoved",{multiple:true,nodeRef:bd.nodeRef,destination:bb})}};var a4=function a3(bc){this._inFlight=false;this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});B.removeClass(this.dragFolderHighlight,"dndFolderHighlight")};this.docLib.modules.actions.genericAction({success:{callback:{fn:a9,scope:this}},failure:{callback:{fn:a4,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:a6,params:{nodeRef:a8.uri}},wait:{message:this.docLib.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:ba,parentId:this.docLib.doclistMetadata.parent.nodeRef}}})},_currTimeoutId:null,onDropTargetOwnerCallBack:function aw(a3,a5){this._clearTimeout();var a4=new Alfresco.util.NodeRef(a3);this._performMove(a4,a5)},_clearTimeout:function ak(){if(this._currTimeoutId!=null){window.clearTimeout(this._currTimeoutId);this._currTimeoutId=null;this._inFlight=false}},_setFailureTimeout:function aM(){this._clearTimeout();var a3=this;this._currTimeoutId=window.setTimeout(function(){a3.animateResult(a3.getDragEl(),a3.getEl());a3._inFlight=false;a3._currTimeoutId=null},500)},onDragOver:function aY(a5,a6){var a3=B.get(a6);if(a3.tagName=="IMG"||a3.className=="droppable"){this.dragFolderHighlight=B.getAncestorByClassName(a3,"folder");B.addClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(B.hasClass(a3,"documentDroppableHighlights")){var a4={elementId:a6,event:a5};YAHOO.Bubbling.fire("documentDragOver",a4)}}},onDragOut:function aN(a5,a6){var a3=B.get(a6);if(a3.tagName=="IMG"||a3.className=="droppable"){this.dragFolderHighlight=B.getAncestorByClassName(a3,"folder");B.removeClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(B.hasClass(a3,"documentDroppableHighlights")){var a4={elementId:a6,event:a5};YAHOO.Bubbling.fire("documentDragOut",a4)}}}});Alfresco.DocumentList=function(a3){Alfresco.DocumentList.superclass.constructor.call(this,"Alfresco.DocumentList",a3,["button","menu","container","datasource","datatable","paginator","json","history"]);this.currentPath="";this.currentPage=1;this.totalRecords=0;this.totalRecordsUpper=null;this.hideMoreActionsFn=null;this.state={actionEditOfflineActive:false};this.currentFilter={filterId:"path",filterData:""};this.actions={};this.selectedFiles={};this.afterDocListUpdate=[];this.doclistMetadata={};this.previewTooltips=[];this.insituEditors=[];this.dynamicControls=[];this.sortControls=[];this.dragAndDropAllowed=true;this.dragAndDropEnabled=false;this.dragEventRefCount=0;this.actionsView="browse";this.renderers={};this.viewRenderers={};this.dataSourceUrl=aJ(Alfresco.constants.URL_SERVICECONTEXT,"components/documentlibrary/data/doclist/");YAHOO.Bubbling.on("activateDynamicControls",this.onActivateDynamicControls,this);YAHOO.Bubbling.on("activateSortControls",this.onActivateSortControls,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("deactivateSortControls",this.onDeactivateSortControls,this);YAHOO.Bubbling.on("metadataRefresh",this.onDocListRefresh,this);YAHOO.Bubbling.on("fileRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("changeFilter",this.onChangeFilter,this);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("folderCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("nodeCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("folderRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("highlightFile",this.onHighlightFile,this);YAHOO.Bubbling.on("registerRenderer",this.onRegisterRenderer,this);YAHOO.Bubbling.on("registerViewRenderer",this.onRegisterViewRenderer,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);YAHOO.Bubbling.on("resizerChanged",this.onResizerChanged,this);YAHOO.Bubbling.on("fileCopied",this.onFileAction,this);YAHOO.Bubbling.on("fileDeleted",this.onFileAction,this);YAHOO.Bubbling.on("fileMoved",this.onFileAction,this);YAHOO.Bubbling.on("filePermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("folderCopied",this.onFileAction,this);YAHOO.Bubbling.on("folderDeleted",this.onFileAction,this);YAHOO.Bubbling.on("folderMoved",this.onFileAction,this);YAHOO.Bubbling.on("folderPermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("filesCopied",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesDeleted",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesMoved",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesPermissionsUpdated",this.onDocListRefresh,this);return this};YAHOO.extend(Alfresco.DocumentList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocumentList,Alfresco.doclib.Actions);Alfresco.DocumentList.generateFilterMarkup=function w(a3){var a4=Alfresco.util.cleanBubblingObject(a3);return YAHOO.lang.substitute("{filterOwner}|{filterId}|{filterData}|{filterDisplay}",a4,function(a6,a7,a5){return typeof a7==="undefined"?"":window.escape(a7)})};Alfresco.DocumentList.generatePathMarkup=function am(a3){return Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aJ(a3.path,a3.file)})};Alfresco.DocumentList.generateCategoryMarkup=function k(a3){return Alfresco.DocumentList.generateFilterMarkup({filterId:"category",filterData:aJ(a3[1],a3[0])})};Alfresco.DocumentList.generateFileFolderLinkMarkup=function h(a5,a3){var a7=a3.jsNode,a4;if(a7.isLink&&G(a5.options.siteId)&&a3.location.site&&a3.location.site.name!==a5.options.siteId){if(a7.isContainer){a4=b("documentlibrary?path="+encodeURIComponent(a3.location.path),{site:a3.location.site.name})}else{a4=a5.getActionUrls(a3,a3.location.site.name).documentDetailsUrl}}else{if(a7.isContainer){if(a3.parent.isContainer){a4='#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(a3.location)}else{if(a3.location.path==="/"){a4='#" class="filter-change" rel="'+Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aJ(a3.location.path,"")})}else{a4="#"}}}else{var a6=a5.getActionUrls(a3);if(a7.isLink&&a7.linkedNode.isContainer){a4=a6.folderDetailsUrl}else{a4=a6.documentDetailsUrl}}}return'<a href="'+a4+'">'};Alfresco.DocumentList.generateThumbnailUrl=function ae(a3,a6){var a5=a3.jsNode,a4=a5.isLink?a5.linkedNode.nodeRef:a5.nodeRef;if(a5.isLink&&!a4){return""}if(a6==null){a6="doclib"}return Alfresco.util.generateThumbnailUrl(a5,a6)};Alfresco.DocumentList.generateFavourite=function aK(a5,a3){var a6=a3.jsNode,a7="favourite."+(a6.isContainer?"folder.":"document."),a4="";if(a3.isFavourite){a4='<a href="#" class="favourite-action enabled" title="'+a5.msg(a7+"remove.tip")+'" tabindex="0"></a>'}else{a4='<a href="#" class="favourite-action" title="'+a5.msg(a7+"add.tip")+'" tabindex="0">'+a5.msg(a7+"add.label")+"</a>"}return a4};Alfresco.DocumentList.generateLikes=function r(a6,a3){var a7=a3.node,a4=a3.likes,a8="like."+(a7.isContainer?"folder.":"document."),a5="";if(a4.isLiked){a5='<a href="#" class="like-action enabled" title="'+a6.msg(a8+"remove.tip")+'" tabindex="0"></a>'}else{a5='<a href="#" class="like-action" title="'+a6.msg(a8+"add.tip")+'" tabindex="0">'+a6.msg(a8+"add.label")+"</a>"}a5+='<span class="likes-count">'+f(a4.totalLikes)+"</span>";return a5};Alfresco.DocumentList.generateComments=function aO(a6,a3){var a9=a3.node,a8=a6.getActionUrls(a3),a4=a8[a9.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",ba="comment."+(a9.isContainer?"folder.":"document.");var a7=(a9.properties["fm:commentCount"]!==undefined);var a5='<a href="'+a4+'" class="comment'+(a7?" hasComments":"")+'" title="'+a6.msg(ba+"tip")+'" tabindex="0">'+a6.msg(ba+"label")+"</a>";if(a7){a5+='<span class="comment-count">'+f(a9.properties["fm:commentCount"])+"</span>"}return a5};Alfresco.DocumentList.generateQuickShare=function y(a4,a3){return new Alfresco.QuickShare().setOptions({nodeRef:a3.jsNode.nodeRef,displayName:a3.displayName}).display(a3.jsNode.properties.qshare_sharedId,a3.jsNode.properties.qshare_sharedBy)};Alfresco.DocumentList.generateUserLink=function aS(a4,a3){if(a3.isDeleted===true){return"<span>"+a4.msg("details.user.deleted",f(a3.userName))+"</span>"}return o(a3.userName,YAHOO.lang.trim(a3.firstName+" "+a3.lastName))};YAHOO.lang.augmentObject(Alfresco.DocumentList.prototype,{options:{sortAscending:true,showFolders:false,simpleView:null,viewRendererName:"detailed",viewRendererNames:["simple","detailed","gallery"],viewRenderers:[],usePagination:false,siteId:"",containerId:"documentLibrary",rootNode:null,initialPage:1,pageSize:50,initialFilter:{},loadingMessageDelay:1000,highlightFile:null,previewTooltips:null,insituEditors:null,groupActivitiesAt:5,inlineEditMimetypes:{"text/plain":true,"text/html":true,"text/xml":true},replicationUrlMapping:{},listUpdated:false,repositoryBrowsing:true,useTitle:true,userIsSiteManager:false,actionsSplitAt:3},state:{actionEditOfflineActive:false},currentPath:null,currentPage:null,totalRecords:null,currentFilter:null,fileUpload:null,actions:null,selectedFiles:null,currentActionsMenu:null,hideMoreActionsFn:null,afterDocListUpdate:null,doclistMetadata:null,dynamicControls:null,sortControls:null,dragAndDropAllowed:null,dragAndDropEnabled:null,dragEventRefCount:null,dragFolderHighlight:null,renderers:null,viewRenderers:null,_userCanUpload:false,onReady:function W(){var bg=this;this.dragAndDropEnabled=this.dragAndDropAllowed&&("draggable" in document.createElement("span"))&&YAHOO.env.ua.mobile===null;var ba=false;var a6=1;for(var a8=0,bj=this.options.viewRendererNames.length;a8<bj;a8++){if(this.options.viewRendererNames[a8]===this.options.viewRendererName){ba=true;a6=a8;break}}if(!ba&&this.options.viewRendererNames.length>0){this.options.viewRendererName=this.options.viewRendererNames[0]}this.userPreferredView=this.options.viewRendererName;this._setupMetadataRenderers();this._setupHistoryManagers();if(B.get(this.id+"-doclistBar")){this.widgets.sortAscending=Alfresco.util.createYUIButton(this,"sortAscending-button",this.onSortAscending);if(this.widgets.sortAscending!==null){this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(!this.options.sortAscending){B.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.sortControls.push(this.widgets.sortAscending)}this.widgets.sortField=Alfresco.util.createYUIButton(this,"sortField-button",this.onSortField,{type:"menu",menu:"sortField-menu",lazyloadmenu:false});if(this.widgets.sortField!==null){this.sortControls.push(this.widgets.sortField);var a4=this.widgets.sortField.getMenu().getItems(),bb;for(bb in a4){if(a4.hasOwnProperty(bb)){if(a4[bb].value===this.options.sortField){this.widgets.sortField.set("label",a4[bb].cfg.getProperty("text")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);break}}}}this.widgets.showFolders=Alfresco.util.createYUIButton(this,"showFolders-button",this.onShowFolders,{type:"checkbox",checked:this.options.showFolders});if(this.widgets.showFolders!==null){this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.dynamicControls.push(this.widgets.showFolders)}if(B.get(this.id+"-simpleDetailed")){this.widgets.viewRendererSelect=new YAHOO.widget.ButtonGroup(this.id+"-simpleDetailed");if(this.widgets.viewRendererSelect!==null){this.widgets.viewRendererSelect.check(a6);this.widgets.viewRendererSelect.on("checkedButtonChange",this.onViewRendererSelect,this.widgets.viewRendererSelect,this);this.dynamicControls.push(this.widgets.viewRendererSelect)}}this.widgets.fileSelect=Alfresco.util.createYUIButton(this,"fileSelect-button",this.onFileSelect,{type:"menu",menu:"fileSelect-menu"});if(this.widgets.fileSelect!==null){this.dynamicControls.push(this.widgets.fileSelect)}if(B.get(this.id+"-options-button")){this.widgets.optionsMenu=Alfresco.util.createYUIButton(this,"options-button",this.onOptionSelect,{type:"menu",menu:"options-menu"});if(this.widgets.optionsMenu!==null){this.dynamicControls.push(this.widgets.optionsMenu)}}}this.services.preferences=new Alfresco.service.Preferences();this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);this._setupViewRenderers();this._setupDataSource();this._setupDataTable();var bi=function a5(bo,bn){if(bg.hideMoreActionsFn){bg.hideMoreActionsFn.call(bg)}var bk=YAHOO.Bubbling.getOwnerByTagName(bn[1].anchor,"div");if(bk!==null){if(typeof bg[bk.id]==="function"){bn[1].stop=true;var bm=bn[1].target;if(typeof bg.viewRenderers[bg.options.viewRendererName]==="object"){bm=bg.viewRenderers[bg.options.viewRendererName].getDataTableRecordIdFromRowElement(bg,bn[1].target)}var bl=bg.widgets.dataTable.getRecord(bm).getData();bg[bk.id].call(bg,bl,bk)}}return true};YAHOO.Bubbling.addDefaultAction("action-link",bi);YAHOO.Bubbling.addDefaultAction("show-more",bi);var be=function bh(bm,bl){var bk=YAHOO.Bubbling.getOwnerByTagName(bl[1].anchor,"div");if(bk!==null){bg.onLikes.call(bg,bl[1].target.offsetParent,bk)}return true};YAHOO.Bubbling.addDefaultAction("like-action",be);var bd=function a3(bm,bl){var bk=YAHOO.Bubbling.getOwnerByTagName(bl[1].anchor,"div");if(bk!==null){bg.onFavourite.call(bg,bl[1].target.offsetParent,bk)}return true};YAHOO.Bubbling.addDefaultAction("favourite-action",bd);var bf=function a7(bm,bl){var bk=bl[1].anchor;if(bk!==null){var bn=bk.rel,bo,bp={};if(bn&&bn!==""){bl[1].stop=true;bo=bn.split("|");bp={filterOwner:window.unescape(bo[0]||""),filterId:window.unescape(bo[1]||""),filterData:window.unescape(bo[2]||""),filterDisplay:window.unescape(bo[3]||"")};Alfresco.logger.debug("DL_fnChangeFilterHandler","changeFilter =>",bp);YAHOO.Bubbling.fire("changeFilter",bp)}}return true};YAHOO.Bubbling.addDefaultAction("filter-change",bf);this.modules.actions=new Alfresco.module.DoclibActions();P.addListener(window,"resize",this._resizeRowContainers,this,true);YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true);try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(bc){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",bc);this.onHistoryManagerReady()}var a9=new Alfresco.widget.FullScreen(this.id);this.fullscreen=a9;YAHOO.util.Event.addListener(B.get(this.id+"-fullscreen-exit-button"),"click",function(bk){a9.toggleFullScreen()});YAHOO.Bubbling.on("fullScreenEnterComplete",function(bl,bk){if(bk[1]&&bk[1].eventGroup==this.id&&(typeof this.viewRenderers[this.options.viewRendererName]==="object")&&this.viewRenderers[this.options.viewRendererName].currentResizeCallback){this.viewRenderers[this.options.viewRendererName].currentResizeCallback()}},this);YAHOO.Bubbling.on("fullScreenExitComplete",function(bl,bk){if(bk[1]&&bk[1].eventGroup==this.id&&(typeof this.viewRenderers[this.options.viewRendererName]==="object")&&this.viewRenderers[this.options.viewRendererName].currentResizeCallback){this.viewRenderers[this.options.viewRendererName].currentResizeCallback()}},this);B.setStyle(this.id+"-options-menu","display","inherit");YAHOO.Bubbling.fire("postDocumentListOnReady",{scope:this,eventGroup:this.id})},_insituCallback:function ao(a5,a4){var a9=a4.jsNode,a8=a9.nodeRef,a7="components/documentlibrary/data";if(G(this.options.siteId)){a7+="/site/"+encodeURIComponent(this.options.siteId)}Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+a7+"/node/"+a8.uri+"?filter="+encodeURIComponent(this.currentFilter.filterId)+"&view="+this.actionsView+"&noCache="+new Date().getTime(),successCallback:{fn:function a3(ba){ba.json.item.jsNode=new Alfresco.util.Node(ba.json.item.node);YAHOO.Bubbling.fire(a9.isContainer?"folderRenamed":"fileRenamed",{file:ba.json.item});return false},scope:this},failureCallback:{fn:function a6(ba){},scope:this}})},fnRenderCellSelected:function aB(){var a3=this;return function a4(a6,a5,a7,a8){if(typeof a3.viewRenderers[a3.options.viewRendererName]==="object"){a3.viewRenderers[a3.options.viewRendererName].renderCellSelected(a3,a6,a5,a7,a8)}}},fnRenderCellStatus:function R(){var a3=this;return function a4(a6,a5,a7,a8){if(typeof a3.viewRenderers[a3.options.viewRendererName]==="object"){a3.viewRenderers[a3.options.viewRendererName].renderCellStatus(a3,a6,a5,a7,a8)}}},fnRenderCellThumbnail:function aW(){var a3=this;return function a4(a6,a5,a7,a8){if(typeof a3.viewRenderers[a3.options.viewRendererName]==="object"){a3.viewRenderers[a3.options.viewRendererName].renderCellThumbnail(a3,a6,a5,a7,a8)}}},fnRenderCellDescription:function aT(){var a3=this;return function a4(a6,a5,a7,a8){if(typeof a3.viewRenderers[a3.options.viewRendererName]==="object"){a3.viewRenderers[a3.options.viewRendererName].renderCellDescription(a3,a6,a5,a7,a8)}}},fnRenderCellActions:function aX(){var a4=this;return function a3(a6,a5,a7,a8){if(typeof a4.viewRenderers[a4.options.viewRendererName]==="object"){a4.viewRenderers[a4.options.viewRendererName].renderCellActions(a4,a6,a5,a7,a8)}}},renderProperty:function(a3){if(YAHOO.lang.isString(a3)){return f(a3)}else{if(YAHOO.lang.isArray(a3)){return a3.length}else{if(YAHOO.lang.isBoolean(a3)){return a3}else{if(YAHOO.lang.isNumber(a3)){return a3}else{if(YAHOO.lang.isObject(a3)){if(a3.hasOwnProperty("iso8601")){return O(a3.iso8601)}else{if(a3.hasOwnProperty("userName")&&a3.hasOwnProperty("displayName")){return Alfresco.util.userProfileLink(a3.userName,a3.displayName)}else{if(a3.hasOwnProperty("displayName")){return f(a3.displayName||"")}else{if(a3.hasOwnProperty("title")){return f(a3.title||"")}else{if(a3.hasOwnProperty("name")){return f(a3.name||"")}}}}}}}}}}return""},onRegisterRenderer:function S(a4,a3){var a5=a3[1];if(a5&&G(a5.propertyName)&&G(a5.renderer)){this.registerRenderer(a5.propertyName,a5.renderer)}else{Alfresco.logger.error("DL_onRegisterRenderer: Custom renderer registion invalid: "+a5)}},onRegisterViewRenderer:function n(a4,a3){var a5=a3[1];if(a5&&G(a5.renderer)){this.registerViewRenderer(a5.renderer)}else{Alfresco.logger.error("DL_onRegisterViewRenderer: Custom view renderer registion invalid: "+a5)}},registerRenderer:function aH(a3,a4){if(G(a3)&&G(a4)){this.renderers[a3]=a4;return true}return false},registerViewRenderer:function Q(a3){if(G(a3)){this.viewRenderers[a3.name]=a3;this.viewRenderers[a3.name].setupRenderer(this);return true}return false},_setupMetadataRenderers:function C(){this.registerRenderer("i18nLabel",function(a3,a4){return a4.replace(/:\s$/,"")});this.registerRenderer("lockBanner",function(a3,a5){var a7=a3.jsNode.properties,ba=a7.lockOwner||a7.workingCopyOwner,a4=Alfresco.DocumentList.generateUserLink(this,ba),a9=a3.jsNode.isContainer,a8="details.banner.",a6="";if(a9){a8+="folder."}if(a3.workingCopy&&G(a3.workingCopy.googleDocUrl)){if(ba.userName===Alfresco.constants.USERNAME){a6=this.msg(a8+"google-docs-owner",'<a href="'+a3.workingCopy.googleDocUrl+'" target="_blank">'+this.msg("details.banner.google-docs.link")+"</a>")}else{a6=this.msg(a8+"google-docs-locked",a4,'<a href="'+a3.workingCopy.googleDocUrl+'" target="_blank">'+this.msg("details.banner.google-docs.link")+"</a>")}}else{if(a3.workingCopy&&ba.userName===Alfresco.constants.USERNAME){a6=this.msg(a8+(a3.workingCopy.isWorkingCopy?"editing":"lock-owner"))}else{if(ba.userName===Alfresco.constants.USERNAME){a6=this.msg(a8+"lock-owner")}else{a6=this.msg(a8+"locked",a4)}}}return a6});this.registerRenderer("syncFailed",function(a3,a4){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-failed")});this.registerRenderer("syncTransientError",function(a3,a4){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-transient-error")});this.registerRenderer("date",function(a3,a4){var a8=a3.jsNode,a6=a8.properties,a5="";var a7="modified",a9=a6.modified.iso8601;if(a3.workingCopy&&a3.workingCopy.isWorkingCopy){a7="editing-started"}else{if(a9===a6.created.iso8601){a7="created"}}a5='<span class="item">'+a4+this.msg("details."+a7+"-by",ac(a9),Alfresco.DocumentList.generateUserLink(this,a6.modifier))+"</span>";return a5});this.registerRenderer("size",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a5="";if(!a7.isContainer&&!a7.isLink){a5+='<span class="item">'+a4+Alfresco.util.formatFileSize(a7.size)+"</span>"}return a5});this.registerRenderer("name",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a5="";if(a7.hasPermission("Write")&&!a7.isLocked&&!a7.hasAspect("cm:workingcopy")){this.insituEditors.push({context:"___"+a3._filenameId,params:{type:"textBox",nodeRef:a7.nodeRef.toString(),name:"prop_cm_name",value:a3.fileName,fnSelect:function a8(ba,bb){var a9=bb.lastIndexOf(Alfresco.util.getFileExtension(bb))-1;if(a9>0){Alfresco.util.selectText(ba,0,a9)}else{ba.select()}},validations:[{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true},when:"keyup",message:this.msg("validation-hint.length.min.max",1,255)},{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")}],title:this.msg("tip.insitu-rename"),errorMessage:this.msg("message.insitu-edit.name.failure")},callback:{fn:this._insituCallback,scope:this,obj:a3}})}a5+='<span id="___'+a3._filenameId+'">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(this,a3);a5+=f(a3.displayName)+"</a></span>";return a5});this.registerRenderer("version",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a5="";if(!a7.isContainer&&!a7.isLink){a5+='<span class="item">'+a4+a3.version+"</span>"}return a5});this.registerRenderer("description",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a8=Alfresco.util.generateDomId(),a5='<span id="'+a8+'" class="faded">'+a4+this.msg("details.description.none")+"</span>";if(a6.description&&a6.description!==""){a5='<span id="'+a8+'" class="item">'+a4+al(f(a6.description))+"</span>"}return a5});this.registerRenderer("mimetype",function(a3,a5){var a7=a3.jsNode,a6="",a4="";if(!a7.isContainer&&!a7.isLink){if(typeof a7.mimetypeDisplayName!=="undefined"){a4=a7.mimetypeDisplayName}else{a4=this.msg("label.mimetype.unknown")}a6+='<span class="item">'+a5+a4+"</span>"}return a6});this.registerRenderer("tags",function(a8,ba){var a4=a8.jsNode,a9=a4.properties,a3=Alfresco.util.generateDomId(),a7="";var bb=a4.tags,bc;if(a4.hasAspect("cm:taggable")&&bb.length>0){for(var a6=0,a5=bb.length;a6<a5;a6++){bc=f(bb[a6]);a7+='<span class="tag" style="display: inline-block"><a href="#" class="tag-link" rel="'+bc+'">'+bc+"</a></span>"}}else{a7+='<span class="faded">'+ba+this.msg("details.tags.none")+"</span>"}if(a4.hasPermission("Write")&&!a4.isLocked){this.insituEditors.push({context:a3,params:{type:"tagEditor",nodeRef:a4.nodeRef.toString(),name:"prop_cm_taggable",value:a8.node.properties["cm:taggable"],validations:[{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")},{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true,ignoreEmpty:true},when:"keyup",message:this.msg("validation-hint.length.min.max",1,255)}],title:this.msg("tip.insitu-tag"),errorMessage:this.msg("message.insitu-edit.tag.failure")},callback:{fn:this._insituCallback,scope:this,obj:a8}})}return'<span id="'+a3+'" class="item">'+ba+a7+"</span>"});this.registerRenderer("categories",function(a9,bb){var a3=a9.jsNode,ba=a3.properties,a7="";if(a3.hasAspect("cm:generalclassifiable")){var a8=a3.categories,a4;a7+='<span class="category-item item">&nbsp;</span><span class="item">'+bb;if(a8.length>0){for(var a6=0,a5=a8.length;a6<a5;a6++){a4=a8[a6];a7+='<span class="category"><a href="#" class="filter-change" rel="'+Alfresco.DocumentList.generateCategoryMarkup(a4)+'">'+f(a4[0])+"</a></span>"+(a5-a6>1?", ":"")}}else{a7+='<span class="faded">'+bb+this.msg("details.categories.none")+"</span>"}a7+="</span>"}return a7});this.registerRenderer("social",function(a3){var a5=a3.jsNode,a4="";a4+='<span class="item item-social">'+Alfresco.DocumentList.generateFavourite(this,a3)+"</span>";a4+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateLikes(this,a3)+"</span>";if(a5.permissions.user.CreateChildren){a4+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateComments(this,a3)+"</span>"}if(!a3.node.isContainer&&Alfresco.constants.QUICKSHARE_URL){a4+='<span class="item item-separator">'+Alfresco.DocumentList.generateQuickShare(this,a3)+"</span>"}return a4})},_setupViewRenderers:function V(){for(var a5=0;a5<this.options.viewRenderers.length;a5++){var a6=this.options.viewRenderers[a5].widget;if(a6!=null){var a4=a6.split(".");var a7=window;for(var a3=0;a3<a4.length;a3++){a7=a7[a4[a3]]}if(typeof a7==="function"){this.registerViewRenderer(new a7(this.options.viewRenderers[a5].id,this,this.options.viewRenderers[a5].jsonConfig))}}}YAHOO.Bubbling.fire("postSetupViewRenderers",{scope:this,eventGroup:this.id})},_setupHistoryManagers:function ax(){var a6=YAHOO.util.History.getBookmarkedState("filter");a6=a6||"path|/";try{while(a6!==(a6=decodeURIComponent(a6.replace(/%25/g,"%2525")))){}}catch(a9){}var a4=function bb(bc){var bd=bc.split("|"),be={filterId:window.unescape(bd[0]||"")};if(typeof bd[1]!=="undefined"){be.filterData=window.unescape(bd[1])}if(typeof bd[2]!=="undefined"){be.filterDisplay=window.unescape(bd[2])}be.filterOwner=Alfresco.util.FilterManager.getOwner(be.filterId);return be};this.options.initialFilter=a4(a6);YAHOO.util.History.register("filter",a6,function a3(bd){Alfresco.logger.debug("HistoryManager: filter changed:"+bd);var bc=YAHOO.util.History.getBookmarkedState("page")||"1";while(bc!==(bc=decodeURIComponent(bc))){}var be=parseInt(bc||this.options.initialPage,10);if(this.currentPage!=be){this.currentPage=be}this._updateDocList.call(this,{filter:a4(bd),page:this.currentPage})},null,this);var a5=function a7(bd,bc){bc.widgets.paginator.setState(bd);YAHOO.util.History.navigate("page",String(bd.page))};if(this.options.usePagination){var ba=YAHOO.util.History.getBookmarkedState("page")||"1";while(ba!==(ba=decodeURIComponent(ba))){}this.currentPage=parseInt(ba||this.options.initialPage,10);YAHOO.util.History.register("page",ba,function a8(bc){Alfresco.logger.debug("HistoryManager: page changed:"+bc);if(this.currentPage!=bc){this._updateDocList.call(this,{page:bc})}else{Alfresco.logger.debug("...page changed event ignored.")}},null,this);this.widgets.paginator=new YAHOO.widget.Paginator({containers:[this.id+"-paginator",this.id+"-paginatorBottom"],rowsPerPage:this.options.pageSize,initialPage:this.currentPage,template:this.msg("pagination.template"),pageReportTemplate:this.msg("pagination.template.page-report"),previousPageLinkLabel:this.msg("pagination.previousPageLinkLabel"),nextPageLinkLabel:this.msg("pagination.nextPageLinkLabel")});this.widgets.paginator.subscribe("changeRequest",a5,this);B.setStyle(this.id+"-doclistBarBottom","display","block")}},_setupDataSource:function ad(){var a4=this;this.widgets.dataSource=new YAHOO.util.DataSource(this.dataSourceUrl,{responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{paginationRecordOffset:"startIndex",totalRecords:"totalRecords",totalRecordsUpper:"totalRecordsUpper"}}});this.widgets.dataSource.doBeforeCallback=function a3(a7,a5,a8){a4.doclistMetadata=a5.metadata;YAHOO.Bubbling.fire("doclistMetadata",{metadata:a4.doclistMetadata});var a6=null;if(a4.doclistMetadata.parent){a6=a4.doclistMetadata.parent.permissions;if(a6&&a6.user){YAHOO.Bubbling.fire("userAccess",{userAccess:a6.user})}}if(typeof a4.viewRenderers[a4.options.viewRendererName]==="object"){a4.viewRenderers[a4.options.viewRendererName].renderEmptyDataSourceHtml(a4,a6)}return a8}},_setupDataTable:function aU(){var bc=this;var a4=B.get("alf-filters"),a5=(a4?parseInt(a4.style.width,10):160)+390;var a6=[{key:"nodeRef",label:"Select",sortable:false,formatter:this.fnRenderCellSelected(),width:16},{key:"status",label:"Status",sortable:false,formatter:this.fnRenderCellStatus(),width:16},{key:"thumbnail",label:"Preview",sortable:false,formatter:this.fnRenderCellThumbnail(),width:100},{key:"fileName",label:"Description",sortable:false,formatter:this.fnRenderCellDescription(),width:(B.getViewportWidth()-a5)},{key:"actions",label:"Actions",sortable:false,formatter:this.fnRenderCellActions(),width:200}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-documents",a6,this.widgets.dataSource,{renderLoopSize:this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE,initialLoad:false,dynamicData:true,MSG_EMPTY:this.msg("message.loading")});var bb=B.getElementsByClassName("yui-dt-empty");if(bb.length>0){bb[0].colSpan=100}this.widgets.dataTable.handleDataReturnPayload=function a8(be,bd,bf){bc.totalRecords=bd.meta.totalRecords;bc.totalRecordsUpper=bd.meta.totalRecordsUpper;return bd.meta};this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.subscribe("tableMsgShowEvent",function(bi){this._elMsgTbody.parentNode.style.width="";if(bi.html&&bi.html.indexOf("docListInstructions")!==-1){var bl=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListToolbar");if(bl!==null){var bj=B.get(bc.id+"-standard-upload-link-template-instance");if(bj!==null){var bm=B.getChildren(bj);P.addListener(bm[0],"click",bl.onFileUpload,bl,true);P.addListener(B.getFirstChild(bm[1]),"click",bl.onFileUpload,bl,true)}var bh=B.get(bc.id+"-new-folder-link-template-instance");if(bh!==null){var bk=B.getChildren(bh);P.addListener(bk[0],"click",bl.onNewFolder,bl,true);P.addListener(B.getFirstChild(bk[1]),"click",bl.onNewFolder,bl,true)}}var bd=B.get(bc.id+"-show-folders-template-instance");if(bd!==null){var bf=function be(){var bn=B.getElementsByClassName("showFolders")[0];bc.options.showFolders=true;bn.innerHTML=this.msg("button.folders.hide");B.replaceClass(bn,"showFolders","hideFolders");bc.services.preferences.set(Z,bc.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")};var bg=B.getChildren(bd);P.addListener(bg[0],"click",bf,bc,true);P.addListener(bg[1],"click",bf,bc,true)}}});this.widgets.dataTable.sortColumn=function(bi,bg){var bd=this.getColumnSortDir(bi);var bj=this.get("sortedBy")||{};var be=(bj.key===bi.key)?true:false;var bf=this.getState();bf.sortedBy={key:bi.key,dir:bd};this.set("sortedBy",bf.sortedBy);var bh="ascending";if(bd!="yui-dt-asc"){bh="descending"}bc.onSortFieldEvent(bi.field,bh)};this.widgets.dataTable.doBeforeLoadData=function a3(bf,bh,bj){if(bh.error){try{var bd=YAHOO.lang.JSON.parse(bh.responseText);bc.widgets.dataTable.set("MSG_ERROR",bd.message)}catch(bi){bc._setDefaultDataTableErrors(bc.widgets.dataTable)}}else{if(bh.results.length===0){B.setStyle(bc.widgets.dataTable._elThead,"display","none");this.fireEvent("renderEvent",{type:"renderEvent"})}else{for(var be=0,bg=bh.results.length;be<bg;be++){bh.results[be].jsNode=new Alfresco.util.Node(bh.results[be].node)}}}return true};this.widgets.dataTable.subscribe("checkboxClickEvent",function a9(bd){var be=bd.target.value;this.selectedFiles[be]=bd.target.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},this,true);this.widgets.dataTable.subscribe("renderEvent",function ba(){Alfresco.logger.debug("DataTable renderEvent");if(0<YAHOO.env.ua.ie&&YAHOO.env.ua.ie<7){var be=this.widgets.dataTable.getTableEl().parentNode;be.className=be.className}if(this.widgets.paginator){Alfresco.logger.debug("Setting paginator state: page="+this.currentPage+", totalRecords="+this.totalRecords);this.widgets.paginator.setState({page:this.currentPage,totalRecords:this.totalRecords});if(this.totalRecordsUpper){this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report.more"))}else{this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report"))}this.widgets.paginator.render()}if(this.options.highlightFile){YAHOO.Bubbling.fire("highlightFile",{fileName:window.unescape(this.options.highlightFile)})}else{if(this.listUpdated){var bi=B.getY(this.id+"-documents"),bd=YAHOO.env.ua.ie>0?((document.compatMode&&document.compatMode!=="BackCompat")?document.documentElement:document.body).scrollTop:window.scrollY;if(bd>bi){window.scrollTo(0,bi)}}}var bh,bg;for(bh=0,bg=this.afterDocListUpdate.length;bh<bg;bh++){this.afterDocListUpdate[bh].call(this)}this.afterDocListUpdate=[];if(typeof this.widgets.previewTooltip!=="undefined"){this.widgets.previewTooltip.cfg.setProperty("context",this.previewTooltips)}var bf;for(bh=0,bg=this.insituEditors.length;bh<bg;bh++){bf=this.insituEditors[bh];Alfresco.util.createInsituEditor(bf.context,bf.params,bf.callback)}this.widgets.dataTable.set("renderLoopSize",this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE)},this,true);this.widgets.dataTable.subscribe("rowMouseoverEvent",this.onEventHighlightRow,this,true);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow,this,true);P.delegate(this.id,"click",function a7(bf,bh){var bg=bh.getAttribute("data-action"),bi=bc.widgets.dataTable.getRecord(bh),bd;if(bi==null){var bj=bc.currentActionsMenu.id;var be=bc.widgets.dataTable.getRecordSet()._records;for(i=0;i<be.length;i++){if(bj.indexOf(be[i]._sId)>0){bi=bc.widgets.dataTable.getRecord(be[i]._sId);bh=bi._sId}}}if(bi!=null){bd=bi.getData()}if(YAHOO.lang.isFunction(bc[bg])){bc[bg].call(bc,bd,bh)}else{if(YAHOO.lang.isFunction(window[bg])){window[bg](bd,bh)}}},"a.indicator-action");if(this.dragAndDropEnabled){P.addListener(document.body,"dragenter",this._swallowDragEnter,this,true);P.addListener(document.body,"dragover",this._swallowDragOver,this,true);P.addListener(document.body,"drop",this._swallowDragDrop,this,true);P.addListener(document.body,"dragstart",this._swallowDragStart,this,true)}},_removeDragAndDrop:function au(){if(this.dragAndDropEnabled){try{var a4=B.get(this.id+"-dl-body");P.removeListener(a4,"dragenter");P.removeListener(a4,"dragover");P.removeListener(a4,"dragleave");P.removeListener(a4,"drop")}catch(a3){Alfresco.logger.error("_removeDragAndDrop: The following exception occurred: ",a3)}}},_addDragAndDrop:function I(){if(this._userCanUpload&&this.dragAndDropEnabled){try{var a4=B.get(this.id+"-dl-body");P.addListener(a4,"dragenter",this.onDocumentListDragEnter,this,true);P.addListener(a4,"dragover",this.onDocumentListDragOver,this,true);P.addListener(a4,"dragleave",this.onDocumentListDragLeave,this,true);P.addListener(a4,"drop",this.onDocumentListDrop,this,true)}catch(a3){Alfresco.logger.error("_addDragAndDrop: The following exception occurred: ",a3)}}},_swallowDragStart:function s(a3){a3.stopPropagation();a3.preventDefault()},_swallowDragEnter:function t(a3){a3.stopPropagation();a3.preventDefault()},_swallowDragOver:function af(a3){a3.dataTransfer.dropEffect="none";a3.stopPropagation();a3.preventDefault()},_swallowDrop:function az(a3){a3.stopPropagation();a3.preventDefault()},onDocumentListDragEnter:function ap(a8){var a4=a8.target,a6=this.widgets.dataTable.getRecord(a4),a3=this.widgets.dataTable.getColumn(a4),a7=this.widgets.dataTable.getContainerEl(),a5;if(a6&&a3&&(a4.tagName=="IMG"||a4.className=="droppable")&&a3.getKey()=="thumbnail"){a5=a6.getData("jsNode");if(a5&&a5.isContainer){this.dragFolderHighlight=B.getAncestorByClassName(a4,"folder");B.addClass(this.dragFolderHighlight,"dndFolderHighlight");B.removeClass(a7,"dndDocListHighlight")}}else{this.dragEventRefCount=Math.min(++this.dragEventRefCount,2);B.addClass(a7,"dndDocListHighlight");if(this.dragFolderHighlight){B.removeClass(this.dragFolderHighlight,"dndFolderHighlight");this.dragFolderHighlight=null}}a8.stopPropagation();a8.preventDefault()},onDocumentListDragOver:function l(a3){a3.dataTransfer.dropEffect=Math.floor(YAHOO.env.ua.gecko)===1?"move":"copy";a3.stopPropagation();a3.preventDefault()},onDocumentListDragLeave:function aZ(a7){var a4=a7.target,a5=this.widgets.dataTable.getRecord(a4),a6=this.widgets.dataTable.getColumn(a4),a3=a5?a5.getData():null;if(a5&&a6&&(a4.tagName=="IMG"||a4.className=="droppable")&&a3.node.isContainer&&a6.getKey()=="thumbnail"){}else{if(--this.dragEventRefCount===0){B.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight")}}a7.stopPropagation();a7.preventDefault()},onDocumentListDrop:function ah(bd){try{if(bd.dataTransfer.files!==undefined&&bd.dataTransfer.files!==null&&bd.dataTransfer.files.length>0){var ba=Alfresco.getDNDUploadProgressInstance();var a4=false;var be="",a7,a6;a6=bd.dataTransfer.files.length;for(a7=0;a7<a6;a7++){if(bd.dataTransfer.files[a7].size>0){a4=true}else{be+='"'+bd.dataTransfer.files[a7].fileName+'", '}}if(!a4){be=be.substring(0,be.lastIndexOf(", "));Alfresco.util.PopupManager.displayMessage({text:ba.msg("message.zeroByteFiles",be)})}if(a4&&ba.uploadMethod===ba.INMEMORY_UPLOAD){var bh=0;a6=bd.dataTransfer.files.length;for(a7=0;a7<a6;a7++){bh+=bd.dataTransfer.files[a7].size}if(bh>ba.getInMemoryLimit()){a4=false;Alfresco.util.PopupManager.displayPrompt({text:ba.msg("inmemory.uploadsize.exceeded",Alfresco.util.formatFileSize(ba.getInMemoryLimit()))})}}if(a4){var bc=this.currentPath,a3=bc.substring(bc.lastIndexOf("/")+1),bf=this.doclistMetadata.parent?this.doclistMetadata.parent.nodeRef:null;var bi=this.widgets.dataTable.getRecord(bd.target);if(bi!==null){var bb=this.widgets.dataTable.getColumn(bd.target),a9=bi.getData();if(bd.target.tagName=="IMG"||bd.target.className=="droppable"){var bg=a9.location;a3=bg.file;bc=aJ(bg.path,bg.file);bf=a9.nodeRef}}B.removeClass(this.widgets.dataTable.getTrEl(bd.target),"dndFolderHighlight");B.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight");var a8={files:bd.dataTransfer.files,uploadDirectoryName:a3,filter:[],mode:ba.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};if(G(this.options.siteId)){a8.siteId=this.options.siteId;a8.containerId=this.options.containerId;a8.uploadDirectory=bc}else{a8.destination=bf}ba.show(a8)}}else{Alfresco.logger.debug("DL_onDocumentListDrop: A drop event was detected, but no files were present for upload: ",bd.dataTransfer)}}catch(a5){Alfresco.logger.error("DL_onDocumentListDrop: The following error occurred when files were dropped onto the Document List: ",a5)}bd.stopPropagation();bd.preventDefault()},onHistoryManagerReady:function z(){if(this.options.initialFilter.filterId==="path"&&window.location.hash=="#upload"){window.location.hash="";var a3=function a4(){YAHOO.Bubbling.fire("showFileUploadDialog",{tooltip:this.msg("dnd.upload.tooltip")})};this.afterDocListUpdate.push(a3)}Alfresco.logger.debug("DL_onHistoryManagerReady","changeFilter =>",this.options.initialFilter);YAHOO.Bubbling.fire("changeFilter",YAHOO.lang.merge({doclistFirstTimeNav:true},this.options.initialFilter));B.setStyle(this.id+"-dl-body","visibility","visible")},getSelectedFiles:function a2(){var a7=[],a8=this.widgets.dataTable.getRecordSet(),a6,a5,a4,a3;for(a4=0,a3=a8.getLength();a4<a3;a4++){a6=a8.getRecord(a4);a5=a6.getData("node");if(this.selectedFiles[a5.nodeRef]){a7.push(a6.getData())}}return a7},selectFiles:function A(be){var bf;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){bf=B.get(this.id+this.viewRenderers[this.options.viewRendererName].parentElementIdSuffix)}var ba=this.widgets.dataTable.getRecordSet(),a5=YAHOO.util.Selector.query('input[type="checkbox"]',bf),a9=a5.length,bg,a7,a6,bd;switch(be){case"selectAll":bd=function bb(bh,bi){return true};break;case"selectNone":bd=function a8(bh,bi){return false};break;case"selectInvert":bd=function a4(bh,bi){return !bi};break;case"selectDocuments":bd=function a3(bh,bi){return !(bh.node.isContainer)};break;case"selectFolders":bd=function a3(bh,bi){return bh.node.isContainer};break;default:bd=function bc(bh,bi){return bi}}for(a6=0;a6<a9;a6++){bg=ba.getRecord(a6);a7=bg.getData();this.selectedFiles[a7.nodeRef]=a5[a6].checked=bd(a7,a5[a6].checked)}YAHOO.Bubbling.fire("selectedFilesChanged")},onSortAscending:function Y(a3,a4){this.widgets.dataTable.set("sortedBy",null);this.options.sortAscending=!this.options.sortAscending;this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(this.options.sortAscending){B.removeClass(this.widgets.sortAscending.get("element"),"sort-descending")}else{B.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.services.preferences.set(aF,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh");if(a3){P.preventDefault(a3)}},onSortEvent:function a1(a3){this.options.sortAscending=(a3!="descending");this.services.preferences.set(aF,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh")},onSortField:function aR(a8,a7,a6){this.widgets.dataTable.set("sortedBy",null);var a3=a7[0],a5=a7[1];if(a5){var a4=this;this.options.sortField=a5.value;this.widgets.sortField.set("label",a5.cfg.getProperty("text")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.services.preferences.set(d,this.options.sortField,{successCallback:{fn:function(){var a9=a5.srcElement.getAttribute("title");if(a9==="true"||a9==="false"){a4.options.sortAscending=(a9==="false");a4.onSortAscending()}else{YAHOO.Bubbling.fire("metadataRefresh")}}}})}P.preventDefault(a3)},onSortFieldEvent:function L(a5,a4){this.options.sortField=a5;var a3=this;this.services.preferences.set(d,a5,{successCallback:{fn:function(){if(a4){a3.options.sortAscending=(a4==="ascending");a3.onSortEvent(a4)}else{YAHOO.Bubbling.fire("metadataRefresh")}}}})},onShowFolders:function j(a3,a4){this.options.showFolders=this.widgets.showFolders.get("checked");this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.services.preferences.set(Z,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh");if(a3){P.preventDefault(a3)}},onShowFoldersEvent:function p(a3){this.options.showFolders=a3;this.services.preferences.set(Z,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")},onViewRendererSelect:function a0(a3,a4){this.widgets.dataTable.set("sortedBy",null);this.options.viewRendererName=this.options.viewRendererNames[a3.newValue.index];this.userPreferredView=this.options.viewRendererName;this.services.preferences.set(aa,this.options.viewRendererName);YAHOO.Bubbling.fire("metadataRefresh");if(a3){P.preventDefault(a3)}},onViewRendererSelectEvent:function aD(a3){var a6=false;for(var a5=0;a5<this.options.viewRendererNames.length&&!a6;a5++){a6=(this.options.viewRendererNames[a5]==a3)}if(a6){this.widgets.dataTable.set("sortedBy",null);this.options.viewRendererName=a3;this.userPreferredView=this.options.viewRendererName;this.services.preferences.set(aa,this.options.viewRendererName);for(var a5=0;a5<this.options.viewRenderers.length;a5++){if(this.options.viewRenderers[a5].id==this.options.viewRendererName){var a4=B.getElementsByClassName("setDefaultView");a4[0].innerHTML=this.msg("button.setDefaultView",this.options.viewRenderers[a5].label);break}}YAHOO.Bubbling.fire("metadataRefresh")}},onFileSelect:function c(a7,a6,a5){var a3=a6[0],a4=a6[1];this.selectFiles(Alfresco.util.findEventClass(a4));P.preventDefault(a3)},onOptionSelect:function aE(a4,ba,bg){var bb=ba[0],bf=ba[1];var a6=Alfresco.util.findEventClass(bf);var a5=bf.element;while((a5!==null)&&((a5.tagName.toLowerCase()!="span")||(a5.className.indexOf("yui")===0))){a5=a5.firstChild}var bc=a5;if(a6=="showFolders"){this.options.showFolders=true;bc.innerHTML=this.msg("button.folders.hide");B.replaceClass(bc,"showFolders","hideFolders");this.services.preferences.set(Z,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")}else{if(a6=="hideFolders"){this.options.showFolders=false;bc.innerHTML=this.msg("button.folders.show");B.replaceClass(bc,"hideFolders","showFolders");this.services.preferences.set(Z,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")}else{if(a6=="showPath"){this.options.hideNavBar=false;bc.innerHTML=this.msg("button.navbar.hide");B.replaceClass(bc,"showPath","hidePath");this.services.preferences.set(F,this.options.hideNavBar);B.setStyle(this.options.associatedToolbar.id+"-navBar","display",this.options.hideNavBar?"none":"block")}else{if(a6=="hidePath"){this.options.hideNavBar=true;bc.innerHTML=this.msg("button.navbar.show");B.replaceClass(bc,"hidePath","showPath");this.services.preferences.set(F,this.options.hideNavBar);B.setStyle(this.options.associatedToolbar.id+"-navBar","display",this.options.hideNavBar?"none":"block")}else{if(a6=="fullWindow"){this.fullscreen.toggleFullScreen(true)}else{if(a6=="fullScreen"){this.fullscreen.toggleFullScreen(false)}else{if(a6=="rss"){window.location=this.options.associatedToolbar._getRssFeedUrl()}else{if(a6=="removeDefaultView"||a6=="setDefaultView"){if(a6=="setDefaultView"){for(var a8=0;a8<this.options.viewRenderers.length;a8++){if(this.options.viewRenderers[a8].id==this.options.viewRendererName){var bd=B.getElementsByClassName("removeDefaultView");bd[0].innerHTML=this.msg("button.removeDefaultView",this.options.viewRenderers[a8].label);break}}}var be=this.doclistMetadata.parent.nodeRef;be=be.replace(/:\//g,"");var a9=this;var a3={prop_app_defaultViewId:(a6=="removeDefaultView"?"":this.options.viewRendererName)};Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.PROXY_URI+"api/node/"+be+"/formprocessor",dataObj:a3,successCallback:{fn:function(){this._updateDocList.call(this)},scope:this},failure:{message:a9.msg("message.save.failure")}})}else{if(a6.indexOf=="view "!=-1){var a7=a6.substring(5);this.onViewRendererSelectEvent(a7)}}}}}}}}}P.preventDefault(bb)},onEventHighlightRow:function ab(a3){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventHighlightRow(this,a3)}},onEventUnhighlightRow:function K(a3){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventUnhighlightRow(this,a3)}},onActionShowMore:function E(a4,a3){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onActionShowMore(this,a4,a3)}},onActionEditOffline:function U(a5){if(!this.state.actionEditOfflineActive){this.state.actionEditOfflineActive=true;var a6=a5.jsNode.nodeRef,a4=a5.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function a7(ba){this.state.actionEditOfflineActive=false;this.options.highlightFile=a4;var a9=function a8(){var bb=false;YAHOO.Bubbling.on("editingCanceled",function(bg,bf){if(ba.config.object.nodeRef==bf[1].record.workingCopy.sourceNodeRef.replace(/:\//g,"")){bb=true}},this);var be=Alfresco.constants.PROXY_URI+ba.json.results[0].downloadUrl;if(YAHOO.env.ua.ie>6){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-offline.success",a4),text:this.msg("message.edit-offline.success.ie7"),buttons:[{text:this.msg("button.download"),handler:function bd(){window.location=be;this.destroy()},isDefault:true},{text:this.msg("button.close"),handler:function bc(){this.destroy()}}]})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-offline.success",a4)});YAHOO.lang.later(3000,this,function(){if(!bb){window.location=be}})}};this.afterDocListUpdate.push(a9)},scope:this}},failure:{callback:{fn:function a3(){this.state.actionEditOfflineActive=false},scope:this},message:this.msg("message.edit-offline.failure",a4)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}",params:{nodeRef:a6.uri}}})}},onActionCheckoutToGoogleDocs:function aQ(a5){var a4=a5.displayName,a7=a5.jsNode.nodeRef,a8=a5.location.path,ba=a5.fileName;var a9=Alfresco.util.PopupManager.displayMessage({displayTime:0,effect:null,text:this.msg("message.checkout-google.inprogress",a4)});this.modules.actions.genericAction({success:{event:{name:"changeFilter",obj:{filterId:"editingMe"}},callback:{fn:function a3(bd){a9.destroy();this.options.highlightFile=a4;var bb=function bc(){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkout-google.success",a4)})};this.afterDocListUpdate.push(bb)},scope:this},activity:{siteId:this.options.siteId,activityType:"google-docs-checkout",page:"document-details",activityData:{fileName:ba,path:a8,nodeRef:a7.toString()}}},failure:{callback:{fn:function a6(bb){a9.destroy();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkout-google.failure",a4)})},scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}?gdc=1",params:{nodeRef:a7.uri}}})},onActionCheckinFromGoogleDocs:function m(a5){var a4=a5.displayName,a6=a5.jsNode.nodeRef,a3=new Alfresco.util.NodeRef(a5.workingCopy.sourceNodeRef),a7=a5.location.path;var a9=Alfresco.util.PopupManager.displayMessage({displayTime:0,effect:null,text:this.msg("message.checkin-google.inprogress",a4)});this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function a8(bc){a9.destroy();var ba=function bb(){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkin-google.success",a4)})};this.afterDocListUpdate.push(ba)},scope:this},activity:{siteId:this.options.siteId,activityType:"google-docs-checkin",page:"document-details",activityData:{fileName:a4,path:a7,nodeRef:a3.toString()}}},failure:{message:this.msg("message.checkin-google.failure",a4)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkin/node/{nodeRef}",params:{nodeRef:a6.uri}}})},_checkIfUpdatedPageIsEmpty:function v(){var a3=(this.currentPage-1)*this.options.pageSize;if(a3>=this.totalRecords){this.widgets.paginator.setPage(1);this.currentPage=1}},onFileAction:function aC(a4,a3){var a5=a3[1];if(a5){if(!a5.multiple){this._checkIfUpdatedPageIsEmpty();this._updateDocList.call(this)}}},onFileRenamed:function M(a4,a3){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onFileRenamed(this,a4,a3)}},onDocListRefresh:function ag(a4,a3){var a5=a3[1];if(a5&&(a5.highlightFile!==null)){this.options.highlightFile=a5.highlightFile}this._checkIfUpdatedPageIsEmpty();this._updateDocList.call(this)},onChangeFilter:function J(a5,a4){var a8=a4[1];if((a8!==null)&&(a8.filterId!==null)){var a7=Alfresco.util.cleanBubblingObject(a8),a6=window.escape(a8.filterId)+(typeof a8.filterData!=="undefined"?"|"+window.escape(a8.filterData)+(typeof a8.filterDisplay!=="undefined"?"|"+window.escape(a8.filterDisplay):""):"");Alfresco.logger.debug("DL_onChangeFilter: ",a7);this._removeDragAndDrop();if(a8.filterId==="path"||a8.filterId==="favourites"){this._addDragAndDrop()}this.listUpdated=true;var a3={filter:a6};if(a8.doclistFirstTimeNav||a6===YAHOO.util.History.getCurrentState("filter")){this._updateDocList.call(this,{filter:a7,page:this.currentPage})}else{if(this.options.usePagination){this.currentPage=1;a3.page="1"}Alfresco.logger.debug("DL_onChangeFilter: objNav = ",a3);if(this.options.highlightFile&&a3.filter===YAHOO.util.History.getCurrentState("filter")){YAHOO.Bubbling.fire("highlightFile",{fileName:this.options.highlightFile})}YAHOO.util.History.multiNavigate(a3)}}},onFilterChanged:function x(a4,a3){var a5=a3[1];if((a5!==null)&&(a5.filterId!==null)){a5.filterOwner=a5.filterOwner||Alfresco.util.FilterManager.getOwner(a5.filterId);this.currentFilter=Alfresco.util.cleanBubblingObject(a5);Alfresco.logger.debug("DL_onFilterChanged: ",this.currentFilter)}},onHighlightFile:function ai(a4,a3){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onHighlightFile(this,a4,a3)}},onDeactivateAllControls:function X(a5,a4){var a3,a6=Alfresco.util.disableYUIButton;for(a3 in this.widgets){if(this.widgets.hasOwnProperty(a3)){a6(this.widgets[a3])}}},onDeactivateDynamicControls:function at(a5,a4){var a3,a6=Alfresco.util.disableYUIButton;for(a3 in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(a3)){a6(this.dynamicControls[a3])}}},onDeactivateSortControls:function aG(a5,a4){var a3,a6=Alfresco.util.disableYUIButton;for(a3 in this.sortControls){if(this.sortControls.hasOwnProperty(a3)){a6(this.sortControls[a3])}}},onActivateSortControls:function g(a5,a4){var a3,a6=Alfresco.util.enableYUIButton;for(a3 in this.sortControls){if(this.sortControls.hasOwnProperty(a3)){a6(this.sortControls[a3])}}},onActivateDynamicControls:function H(a5,a4){var a3,a6=Alfresco.util.enableYUIButton;for(a3 in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(a3)){a6(this.dynamicControls[a3])}}},onLikes:function D(a9){var a6=a9;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){a6=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,a9)}var ba=this.widgets.dataTable.getRecord(a6),a7=ba.getData(),a8=a7.jsNode.nodeRef,a4=a7.likes;a4.isLiked=!a4.isLiked;a4.totalLikes+=(a4.isLiked?1:-1);var bb={successCallback:{fn:function a3(bi,bf){var bj=bi.json.data;if(bj){var bh=this._findRecordByParameter(bf,"nodeRef"),bc=bh.getData(),bg=bc.node,bd=bc.likes;bd.totalLikes=bj.ratingsCount;this.widgets.dataTable.updateRow(bh,bc);if(bd.isLiked){var be={fileName:bc.fileName,nodeRef:bg.nodeRef};if(bg.isContainer){this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",be)}else{this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",be)}}}},scope:this,obj:a8.toString()},failureCallback:{fn:function a5(bg,be){var bf=this._findRecordByParameter(be,"nodeRef"),bc=bf.getData(),bd=bc.likes;bd.isLiked=!bd.isLiked;bd.totalLikes+=(bd.isLiked?1:-1);this.widgets.dataTable.updateRow(bf,bc);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",bc.displayName)})},scope:this,obj:a8.toString()}};if(a4.isLiked){this.services.likes.set(a8,1,bb)}else{this.services.likes.remove(a8,bb)}this.widgets.dataTable.updateRow(ba,a7)},onFavourite:function aA(a9){var a6=a9;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){a6=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,a9)}var ba=this.widgets.dataTable.getRecord(a6),a7=ba.getData(),a5=a7.node,a8=a5.nodeRef;a7.isFavourite=!a7.isFavourite;this.widgets.dataTable.updateRow(ba,a7);var a4=a7.isFavourite?"favouriteDocumentOrFolder":"unFavouriteDocumentOrFolder";var bb={failureCallback:{fn:function a3(bg,bc){var bf=this.widgets.dataTable.getRecord(bc),bd=bf.getData(),be=bd.node;bd.isFavourite=!bd.isFavourite;this.widgets.dataTable.updateRow(bf,bd);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",bd.displayName)})},scope:this,obj:a9}};this.services.preferences[a4].call(this.services.preferences,a5,bb)},onResizerChanged:function aP(){this._resizeRowContainers()},_resizeRowContainers:function an(a6){if(!YAHOO.lang.isNumber(a6)){var a3=B.get("alf-filters"),a7=(a3?parseInt(a3.style.width,10):160)+390,a6=(B.getViewportWidth()-a7)+"px"}else{a6=(a6-390)+"px"}var a4=YAHOO.util.Selector.query("h3.filename",this.id+"-documents");for(var a5=0;a5<a4.length;a5++){a4[a5].parentNode.style.width=a6}},_setDefaultDataTableErrors:function e(a3){var a4=Alfresco.util.message;a3.set("MSG_EMPTY",a4("message.empty","Alfresco.DocumentList"));a3.set("MSG_ERROR",a4("message.error","Alfresco.DocumentList"))},_updateDefaultViewOptions:function ay(a8){var a6=B.getElementsByClassName("removeDefaultView");var a7=null;if(a6.length>0){a7=a6[0].parentNode.parentNode}var a3=B.getElementsByClassName("setDefaultView");var a5=null;if(a3.length>0){a5=a3[0].parentNode.parentNode}if(this.options.userIsSiteManager||(this.doclistMetadata.parent.properties!=null&&this.doclistMetadata.parent.properties["cm:creator"].userName==Alfresco.constants.USERNAME)){if(this.doclistMetadata.parent.properties!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=""){for(var a4=0;a4<this.options.viewRenderers.length;a4++){if(this.options.viewRenderers[a4].id==this.doclistMetadata.parent.properties["app:defaultViewId"]){a6[0].innerHTML=this.msg("button.removeDefaultView",this.options.viewRenderers[a4].label);break}}B.removeClass(a7,"hidden");if(this.doclistMetadata.parent.properties["app:defaultViewId"]==this.options.viewRendererName){B.addClass(a5,"hidden")}else{B.removeClass(a5,"hidden")}}else{B.removeClass(a5,"hidden");B.addClass(a7,"hidden")}}else{B.addClass(a5,"hidden");B.addClass(a7,"hidden")}if(a8){if(this.doclistMetadata.parent.properties&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=""){this.options.viewRendererName=this.doclistMetadata.parent.properties["app:defaultViewId"];B.addClass(a5,"hidden")}else{if(this.userPreferredView!=this.options.viewRendererName){this.options.viewRendererName=this.userPreferredView}}}for(var a4=0;a4<this.options.viewRenderers.length;a4++){if(this.options.viewRenderers[a4].id==this.options.viewRendererName){a3[0].innerHTML=this.msg("button.setDefaultView",this.options.viewRenderers[a4].label);break}}},_updateDocList:function aI(bg){bg=bg||{};Alfresco.logger.debug("DL__updateDocList: ",bg.filter,bg.page);var bi=YAHOO.lang.merge({doclistFirstTimeNav:false},bg.filter!==undefined?bg.filter:this.currentFilter),a4=bg.page!==undefined?bg.page:this.currentPage,bc=null,a8=null,be=this,a6={filter:bi,page:a4};var a9=function bd(){Alfresco.logger.debug("DL__uDL_fnShowLoadingMessage: slow data webscript detected.");if(a8){bc=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+f(this.msg("message.loading"))+"</span>",noEscape:true});if(YAHOO.env.ua.ie>0){this.loadingMessageShowing=true}else{bc.showEvent.subscribe(function(){this.loadingMessageShowing=true},this,true)}}};this._setDefaultDataTableErrors(this.widgets.dataTable);this.previewTooltips=[];this.insituEditors=[];this.hideMoreActionsFn=null;this.loadingMessageShowing=false;a8=YAHOO.lang.later(this.options.loadingMessageDelay,this,a9);var bh=function ba(){if(a8){a8.cancel();a8=null}if(bc){if(this.loadingMessageShowing){bc.destroy();bc=null}else{YAHOO.lang.later(100,be,bh)}}};var bb=function a5(bm,bo,bp){bh();var bj=function bk(){YAHOO.Bubbling.fire("activateDynamicControls");YAHOO.Bubbling.fire("selectedFilesChanged");this.listUpdated=false;if(this.currentFilter.filterId=="recentlyModified"||this.currentFilter.filterId=="recentlyAdded"){YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("activateSortControls")}};this.afterDocListUpdate.push(bj);Alfresco.logger.debug("currentFilter was:",this.currentFilter,"now:",bi);Alfresco.logger.debug("currentPage was ["+this.currentPage+"] now ["+a4+"]");this.currentFilter=bi;this.currentPage=a4;var bq=false;if(bi.filterId==="path"){Alfresco.logger.debug("currentPath was ["+this.currentPath+"] now ["+bi.filterData+"]");bq=(this.currentPath!=bi.filterData);this.currentPath=bi.filterData}delete bi.doclistFirstTimeNav;YAHOO.Bubbling.fire("filterChanged",bi);this._updateDefaultViewOptions(bq);for(var bl=0,bn=this.options.viewRendererNames.length;bl<bn;bl++){if(typeof this.viewRenderers[this.options.viewRendererNames[bl]]==="object"){this.viewRenderers[this.options.viewRendererNames[bl]].destroyView(this,bm,bo,bp)}}if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].renderView(this,bm,bo,bp)}else{}};var a3=function a7(bj,bk){bh();this.afterDocListUpdate=[];if(bk.status===401){window.location.reload(true)}else{try{if(bk.status===404){YAHOO.Bubbling.fire("deactivateDynamicControls");YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("deactivateAllControls")}var bn=function bl(bq,bp){return function bo(){this.widgets.paginator.setState({totalRecords:0});this.widgets.paginator.render();this.widgets.dataTable.set("MSG_ERROR",bq);if(bp===410){this.widgets.dataTable.showTableMessage(bq,YAHOO.widget.DataTable.CLASS_DISABLED)}else{this.widgets.dataTable.showTableMessage(bq,YAHOO.widget.DataTable.CLASS_ERROR)}}};this.afterDocListUpdate.push(bn(YAHOO.lang.JSON.parse(bk.responseText).message,bk.status));this.widgets.dataTable.initializeTable();this.widgets.dataTable.render();this.listUpdated=false}catch(bm){Alfresco.logger.error(bm);this._setDefaultDataTableErrors(this.widgets.dataTable)}}};if(a6.filter&&a6.filter.filterId==="path"){a6.path=a6.filter.filterData;if(this.currentFilter.filterData!=a6.path){Alfresco.logger.debug("currentFilter.filterData was ["+this.currentFilter.filterData+"] now ["+a6.path+"]");this.currentFilter.filterData=a6.path}}var bf=this._buildDocListParams(a6);Alfresco.logger.debug("DataSource requestParams: ",bf);this.widgets.dataSource.sendRequest(bf,{success:bb,failure:a3,scope:this})},_buildDocListParams:function a(a7){var a4=G(this.options.siteId),a5={path:this.currentPath,type:this.options.showFolders?"all":"documents",site:this.options.siteId,container:this.options.containerId,filter:this.currentFilter};if(this.options.usePagination){a5.page=this.widgets.paginator.getCurrentPage()||this.currentPage;a5.pageSize=this.widgets.paginator.getRowsPerPage()}if(typeof a7==="object"){a5=YAHOO.lang.merge(a5,a7)}var a3=a4?"site/{site}/{container}":"node/alfresco/company/home",a6=YAHOO.lang.substitute("{type}/"+a3+(a5.filter.filterId==="path"?"{path}":""),{type:encodeURIComponent(a5.type),site:encodeURIComponent(a5.site),container:encodeURIComponent(a5.container),path:aJ("/",Alfresco.util.encodeURIPath(a5.path))});a6+="?filter="+encodeURIComponent(a5.filter.filterId);if(a5.filter.filterData&&a5.filter.filterId!=="path"){a6+="&filterData="+encodeURIComponent(a5.filter.filterData)}if(this.options.usePagination){a6+="&size="+a5.pageSize+"&pos="+a5.page}a6+="&sortAsc="+this.options.sortAscending+"&sortField="+encodeURIComponent(this.options.sortField);if(!a4){a6+="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}a6+="&view="+this.actionsView+"&noCache="+new Date().getTime();return a6},_findRecordByParameter:function aL(a9,a8){var a7=this.widgets.dataTable.getRecordSet(),a6,a3,a5,a4;for(a5=0,a4=a7.getLength();a5<a4;a5++){a6=a7.getRecord(a5);a3=a6.getData();if(a3[a8]===a9||(a3.node&&a3.node[a8]===a9)){return a6}}return null}},true)})();