define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Explorer.html","dojo/text!./templates/ExplorerTab.html","dojo/text!./templates/ExplorerItem.html","alfresco/core/Core","alfresco/core/CoreXhr","service/constants/Default","alfresco/renderers/FileType","dojo/on","dojo/string","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-style"],function(w,b,r,x,k,y,j,f,i,c,h,d,g,z,e,p){return w([b,r,j,f],{cssRequirements:[{cssFile:"./css/Explorer.css"}],templateString:x,currentLocations:null,nodeRef:"alfresco/company/home",selectableType:"cm:content",hideUnselectableTypes:false,needsCreatePermissionToSelect:false,needsEditPermissionToSelect:false,needsDeletePermissionToSelect:false,postCreate:function v(){this.currentLocations=[];p.set(this.contentFrameNode,"width",this.contentFrameWidth+"px");this.serviceXhr({url:i.PROXY_URI+"api/forms/picker/node/"+this.nodeRef+"/children?selectableType="+this.selectableType,data:{selectableType:this.selectableType,searchTerm:"",size:"1000"},method:"GET",successCallback:this.processLocations,callbackScope:this})},processLocations:function t(B,A){this.appendLocation(B.data.parent,B.data.items)},contentFrameWidth:500,idAttr:"nodeRef",locationDisplayAttr:"name",selectLocation:function q(B){var C=[];var A=false;g.forEach(this.currentLocations,function(D,E){if(A){C.splice(0,0,D)}if(D.id==B){A=true;this.focusLocation(D)}},this);setTimeout(z.hitch(this,"removeLocations",C),1000)},removeLocations:function o(A){g.forEach(A,function(B,C){this.removeLocation(B)},this)},focusLocation:function a(A){var B="-"+((A.index)*this.contentFrameWidth)+"px";p.set(this.contentItemsNode,"left",B)},appendLocation:function n(G,B){if(B==null){}else{}var C=this.currentLocations.length;p.set(this.contentItemsNode,"width",(this.contentFrameWidth*(C+1))+"px");var E=G[this.idAttr];var F=this.createLocationTab(G,C);h(F,"click",z.hitch(this,"selectLocation",E));e.place(F,this.navigationNode);var D=this.createLocationContent(G,B);e.place(D,this.contentItemsNode);var A={id:E,index:C,data:G,node:D,tab:F};this.currentLocations.push(A);this.focusLocation(A)},removeLocation:function s(A){this.contentItemsNode.removeChild(A.node);this.navigationNode.removeChild(A.tab);this.currentLocations.splice(A.index,1)},tabClass:"",createLocationTab:function m(C,A){var B=e.toDom(d.substitute(k,{tabClass:this.tabClass,index:A,title:C[this.locationDisplayAttr]}));return B},itemDisplayAttr:"name",createLocationContent:function u(C,B){var A=e.create("div",{className:"content-item",style:{width:this.contentFrameWidth+"px"}});g.forEach(B,function(G,F){if(this.hideUnselectableTypes==true&&G.selectable==false){}else{var E="";if(!G.selectable==true){E+=" unselectable"}var I=e.create("div",{className:E},A);var D=e.create("span",{},I);new c({size:"small",currentItem:G},D);var H=e.create("span",{innerHTML:G[this.itemDisplayAttr]},I);if(G.isContainer==true){h(I,"click",z.hitch(this,"getLocation",G[this.idAttr]))}}},this);return A},getLocation:function l(A){this.serviceXhr({url:i.PROXY_URI+"api/forms/picker/node/"+A.replace(/:\//g,"")+"/children?selectableType="+this.selectableType,data:{selectableType:"cm:content",searchTerm:"",size:"1000"},method:"GET",successCallback:this.processLocations,callbackScope:this})}})});