define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Grid.html","alfresco/documentlibrary/views/layouts/_MultiItemRendererMixin","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","dojo/keys","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-geometry","dojo/query","dojo/dom-style","dijit/registry","dojo/dom","dojo/on"],function(v,a,r,y,z,k,o,m,A,h,g,u,e,q,i,t,j){return v([a,r,z,k,o],{cssRequirements:[{cssFile:"./css/Grid.css"}],templateString:y,columns:4,postCreate:function d(){this.inherited(arguments);if(this.widgets){this.processWidgets(this.widgets,this.containerNode)}j(window,"resize",A.hitch(this,"resizeCells"));this.alfSubscribe("ALF_NODE_RESIZED",A.hitch(this,"onNodeResized"))},setupKeyboardNavigation:function b(){this._keyNavCodes[m.UP_ARROW]=A.hitch(this,"focusOnCellAbove");this._keyNavCodes[m.RIGHT_ARROW]=A.hitch(this,"focusOnCellRight");this._keyNavCodes[m.DOWN_ARROW]=A.hitch(this,"focusOnCellBelow");this._keyNavCodes[m.LEFT_ARROW]=A.hitch(this,"focusOnCellLeft")},focusOnCellLeft:function l(){var B=null;focusIndex=this.getIndexOfChild(this.focusedChild),allChildren=this.getChildren(),childCount=this.getChildren().length;if(focusIndex>0){B=allChildren[focusIndex-1]}else{B=allChildren[childCount-1]}this.focusChild(B)},focusOnCellRight:function l(){var B=null;focusIndex=this.getIndexOfChild(this.focusedChild),allChildren=this.getChildren(),childCount=this.getChildren().length;if(focusIndex<childCount-1){B=allChildren[focusIndex+1]}else{B=allChildren[0]}this.focusChild(B)},focusOnCellAbove:function f(){var B=null;focusIndex=this.getIndexOfChild(this.focusedChild),focusColumn=(focusIndex%this.columns)+1,allChildren=this.getChildren(),childCount=this.getChildren().length;if(focusIndex-this.columns<0){var C=childCount%this.columns;if(C==0||C>=focusColumn){B=allChildren[childCount-(this.columns-focusColumn)+1]}else{B=allChildren[childCount-1]}}else{B=allChildren[focusIndex-this.columns]}this.focusChild(B)},focusOnCellBelow:function w(){var B=null;focusIndex=this.getIndexOfChild(this.focusedChild),focusColumn=(focusIndex%this.columns),allChildren=this.getChildren(),childCount=this.getChildren().length;if((focusIndex+this.columns)>=childCount){B=allChildren[focusColumn]}else{B=allChildren[focusIndex+this.columns]}this.focusChild(B)},onNodeResized:function x(B){if(t.isDescendant(this.domNode,B.node)){this.resizeCells()}},resizeCells:function s(){this.alfLog("info","Resizing");if(A.exists("containerNode.parentNode",this)&&this.containerNode.parentNode!=null){var B=u.getContentBox(this.containerNode.parentNode);var C=(Math.floor(B.w/this.columns)-4)+"px";e("tr > td",this.containerNode).forEach(A.hitch(this,"resizeCell",B,C))}},resizeCell:function p(F,E,D,B){q.set(D,{width:E});var C={w:E,h:null};h.forEach(D.children,A.hitch(this,"resizeWidget",C))},resizeWidget:function c(C,E,B){var D=i.byNode(E);if(D!=null&&typeof D.resize==="function"){D.resize(C)}},createWidgetDomNode:function n(G,D,C){var B=D;if(this.currentIndex%this.columns==0){var E=g.create("TR",{},D);B=g.create("TD",{},E)}else{var F=D.children[D.children.length-1];B=g.create("TD",{},F)}return g.create("DIV",{},B)}})});