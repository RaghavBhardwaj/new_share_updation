define(["dojo/_base/declare","alfresco/renderers/_ActionsMixin","alfresco/menus/AlfMenuGroup","dojo/_base/array","dojo/_base/lang","service/constants/Default"],function(e,h,j,i,b,c){return e([h],{widgetsForLoading:[{name:"alfresco/header/AlfMenuItem",config:{iconClass:"alf-loading-icon",label:"loading.label"}}],addActions:function d(){this.actionsGroup.processWidgets(this.widgetsForLoading);if(this.actionsMenu.popup){this.actionsMenu.popup.onOpen=dojo.hitch(this,"loadActions")}else{this.alfLog("log","No Sites Menu popup - something has gone wrong!")}},_actionsLoaded:false,loadActions:function f(){if(this._actionsLoaded){this.alfLog("log","Actions already loaded")}else{this.alfLog("log","Loading actions");this.getXhrData()}},getXhrData:function a(){var n=b.getObject("nodeRef",false,this.currentItem);if(n!=null){var m=this.generateUuid();this._xhrDataRequestHandle=this.alfSubscribe(m+"_SUCCESS",b.hitch(this,"onXhrData"),true);this.alfPublish("ALF_RETRIEVE_SINGLE_DOCUMENT_REQUEST",{alfResponseTopic:m,nodeRef:n},true)}else{this.alfLog("warn","No nodeRef attribute available to use to retrieve all data.",this)}},onXhrData:function k(m){if(this._xhrDataRequestHandle!=null){this.alfUnsubscribe(this._xhrDataRequestHandle)}else{this.alfLog("warn","A subscription handle was not found for processing XHR layout data - this could be a potential memory leak",this)}if(b.exists("response.item",m)){this._actionsLoaded=true;this.currentItem=m.response.item;this.clearLoadingItem();this.addXhrItems()}else{this.alfLog("warn","Document data was provided but the 'response.item' attribute was not found",m,this)}},clearLoadingItem:function g(){i.forEach(this.actionsMenu.popup.getChildren(),function(n,m){this.actionsMenu.popup.removeChild(n)},this)},addXhrItems:function l(){this.actionsGroup=new j({});this.actionsMenu.popup.addChild(this.actionsGroup);i.forEach(this.currentItem.actions,b.hitch(this,"addAction"))}})});