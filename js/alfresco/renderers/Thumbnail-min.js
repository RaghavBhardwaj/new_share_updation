define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","alfresco/renderers/_JsNodeMixin","alfresco/node/DraggableNodeMixin","alfresco/node/NodeDropTargetMixin","dijit/_OnDijitClickMixin","dojo/text!./templates/Thumbnail.html","alfresco/core/Core","alfresco/renderers/_ItemLinkMixin","alfresco/documentlibrary/_AlfDndDocumentUploadMixin","service/constants/Default","dojo/_base/lang","dojo/_base/event","alfresco/core/NodeUtils"],function(s,c,o,d,e,a,m,t,l,j,k,i,v,p,h){return s([c,o,m,d,e,a,l,j,k],{cssRequirements:[{cssFile:"./css/Thumbnail.css"}],templateString:t,customClasses:"",postMixInProperties:function g(){this.imgId="";this.thumbnailUrl="";this.imgAltText="";this.imgTitle="";if(this.currentItem!=null&&this.currentItem.node){var x=this.currentItem.jsNode;this.thumbnailUrl=this.generateThumbnailUrl();if(this.currentItem.displayName==null){this.currentItem.displayName=x.properties["cm:name"]}this.imgTitle=this.encodeHTML(this.currentItem.displayName);this.imgAltText=(this.currentItem.displayName!=null)?this.currentItem.displayName.substring(this.currentItem.displayName.lastIndexOf(".")):"";this.imgId=x.nodeRef.nodeRef}else{if(this.currentItem!=null&&this.currentItem.nodeRef!=null){var w=h.processNodeRef(this.currentItem.nodeRef);if(this.currentItem.type==="folder"){this.thumbnailUrl=i.URL_RESCONTEXT+"components/search/images/folder.png"}else{if(this.currentItem.type==="document"){this.thumbnailUrl=i.PROXY_URI+"api/node/"+w.uri+"/content/thumbnails/doclib/?c=queue&ph=true&lastModified="+this.currentItem.modifiedOn}else{this.thumbnailUrl=this.generateFallbackThumbnailUrl()}}}}},generateFallbackThumbnailUrl:function n(){return this.thumbnailUrl=i.URL_RESCONTEXT+"components/search/images/generic-result.png"},getFolderImage:function r(){return i.URL_RESCONTEXT+"components/documentlibrary/images/folder-64.png"},renditionName:"doclib",generateThumbnailUrl:function f(){var w=null;if(this.renditionName==null){this.renditionName="doclib"}if(this.currentItem!=null&&this.currentItem.node){var z=this.currentItem.jsNode;if(z.isContainer||(z.isLink&&z.linkedNode.isContainer)){w=this.getFolderImage()}else{var y=z.isLink?z.linkedNode.nodeRef:z.nodeRef;if(z.properties["cm:lastThumbnailModification"]){var A=z.properties["cm:lastThumbnailModification"];for(var x=0;x<A.length;x++){if(A[x].indexOf(this.renditionName)!=-1){w=i.PROXY_URI+"api/node/"+y.uri+"/content/thumbnails/"+this.renditionName+"?c=queue&ph=true&lastModified="+A[x];break}}}}}if(w==null){w=i.PROXY_URI+"api/node/"+y.uri+"/content/thumbnails/"+this.renditionName+"?c=queue&ph=true"}return w},postCreate:function q(){this.inherited(arguments);var w=v.getObject("currentItem.jsNode.isContainer",false,this);if(w==true){this.addUploadDragAndDrop(this.imgNode);this.addNodeDropTarget(this.imgNode)}},onLinkClick:function b(w){p.stop(w);if(this.publishTopic==null||this.publishTopic.trim()==""){this.alfLog("warn","No publishTopic provided for PropertyLink",this)}else{var y=(this.publishGlobal!=null)?this.publishGlobal:false;var x=(this.publishToParent!=null)?this.publishToParent:false;this.alfPublish(this.publishTopic,this.getPublishPayload(),y,x)}},getPublishPayload:function u(){return this.publishPayload}})});