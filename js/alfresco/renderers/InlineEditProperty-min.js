define(["dojo/_base/declare","alfresco/renderers/Property","dijit/_OnDijitClickMixin","alfresco/core/CoreXhr","dojo/text!./templates/InlineEditProperty.html","dojo/dom-class","dojo/html","dojo/dom-attr","dojo/_base/fx","dojo/keys","dojo/_base/event","service/constants/Default"],function(u,f,l,e,x,g,j,t,c,n,q,i){return u([f,l,e],{cssRequirements:[{cssFile:"./css/InlineEditProperty.css"}],templateString:x,postParam:null,postMixInProperties:function o(){this.inherited(arguments);if(this.postParam==null&&this.propertyToRender!=null){this.postParam="prop_"+this.propertyToRender.replace(/:/g,"_")}},onEditClick:function s(y){if(this.renderPropertyNotFound){t.set(this.editInputNode,"value","")}g.toggle(this.renderedValueNode,"hidden");g.toggle(this.editNode,"hidden");this.editInputNode.focus();if(y!=undefined){q.stop(y)}},onKeyPress:function b(y){if(y.ctrlKey==true&&y.charCode=="101"){q.stop(y);this.onEditClick()}},onValueEntryKeyPress:function k(y){if(y.charOrCode==n.ESCAPE){q.stop(y);this.onCancel()}else{if(y.charOrCode==n.ENTER){q.stop(y);this.onSave()}}},onSave:function d(y){if(this.postParam!=null){var z={url:this.getSaveUrl(),method:"POST",data:this.getSaveData(),successCallback:this.onPropertyUpdate,failureCallback:this.onPropertyUpdateFailure,callbackScope:this};this.serviceXhr(z)}},getSaveUrl:function m(){var z=new Alfresco.util.NodeRef(this.currentItem.nodeRef);var y=i.PROXY_URI+"api/node/"+z.uri+"/formprocessor";return y},getSaveData:function p(){var y={};y[this.postParam]=t.get(this.editInputNode,"value");return y},onPropertyUpdate:function v(y,B){this.alfLog("log","Property '"+this.propertyToRender+"' successfully updated for node: ",this.currentItem);this.renderedValue=B.data[this.postParam];var z=(this.requestedValuePrefix)?this.requestedValuePrefix:this.renderedValuePrefix;var A=(this.requestedValueSuffix)?this.requestedValueSuffix:this.renderedValueSuffix;j.set(this.renderedValueNode,z+this.renderedValue+A);g.remove(this.renderedValueNode,"hidden faded");g.add(this.editNode,"hidden");this.renderedValueNode.focus()},onPropertyUpdateFailure:function h(y,z){this.alfLog("warn","Property '"+this.propertyToRender+"' was not updated for node: ",this.currentItem);this.onCancel()},onCancel:function a(){g.remove(this.renderedValueNode,"hidden");g.add(this.editNode,"hidden");t.set(this.editInputNode,"value",this.renderedValue);this.renderedValueNode.focus()},showEditIcon:function r(){c.fadeIn({node:this.editIconNode}).play()},hideEditIcon:function w(){c.fadeOut({node:this.editIconNode}).play()}})});