define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","alfresco/services/_PreferenceServiceTopicMixin","dojo/text!./templates/AlfSideBarContainer.html","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","dijit/layout/BorderContainer","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/dom-class","dojo/on","dojo/dom-geometry","dojo/window"],function(v,c,s,f,w,n,o,r,y,j,q,l,m,t,h){return v([c,s,f,n,o],{cssRequirements:[{cssFile:"/themes/lightTheme/yui/assets/skin.css"},{cssFile:"/css/yui-fonts-grids.css"},{cssFile:"./css/AlfSideBarContainer.css"}],templateString:w,nonAmdDependencies:["/yui/yahoo-dom-event/yahoo-dom-event.js","/yui/dragdrop/dragdrop.js","/yui/element/element.js","/yui/animation/animation.js","/yui/resize/resize.js"],showSidebar:true,minSidebarWidth:150,initialSidebarWidth:150,lastSidebarWidth:null,resizer:null,resizeHandlerNode:null,footerHeight:0,customResizeTopics:null,sidebarWidthPreferenceId:"org.alfresco.share.sideBarWidth",postMixInProperties:function g(){this.alfPublish(this.getPreferenceTopic,{preference:this.sidebarWidthPreferenceId,callback:this.setSideBarWidth,callbackScope:this})},setSideBarWidth:function k(z){if(z!=null){this.initialSidebarWidth=z}},postCreate:function b(){if(this.widgets){j.forEach(this.widgets,y.hitch(this,"addWidget"))}var B=parseInt(q.get(this.domNode,"width"),10);var z=(B-this.minSidebarWidth);this.resizer=new YAHOO.util.Resize(this.sidebarNode,{handles:["r"],minWidth:this.minSidebarWidth,maxWidth:z});var A=dojo.query(".yui-resize-handle-inner-r",this.domNode);if(A!=null&A.length==1){this.resizeHandlerNode=A[0];m(this.resizeHandlerNode,"click",y.hitch(this,"onResizeHandlerClick"))}else{this.alfLog("warn","An expected number of resize handles were found",A)}this.alfSubscribe("ALF_DOCLIST_SHOW_SIDEBAR",y.hitch(this,"showEventListener"));if(this.customResizeTopics!=null&&this.customResizeTopics.length){var C=this;j.forEach(this.customResizeTopics,function(D,E){C.alfSubscribe(D,y.hitch(C,"resizeHandler"))})}this.resizer.on("resize",y.hitch(this,"resizeHandler"));this.resizer.on("endResize",y.hitch(this,"endResizing"));m(window,"resize",y.hitch(this,"resizeHandler"));this.lastSidebarWidth=this.initialSidebarWidth;this.resizeHandler({width:this.lastSidebarWidth});this.render(this.showSidebar)},addWidget:function p(B,z){var A=null;if(B.align=="sidebar"){A=this.createWidgetDomNode(B,this.sidebarNode)}else{A=this.createWidgetDomNode(B,this.mainNode)}this.createWidget(B,A)},resizeHandler:function u(G){var I=parseInt(q.get(this.domNode,"width"),10);var F=this.lastSidebarWidth;if(G&&G.width!=null){F=G.width;this.lastSidebarWidth=F}var D=t.getMarginBox(this.containerNode);var z=h.getBox();var A=z.h-D.t-this.footerHeight;var H=this.calculateHeight(this.sidebarNode,0,this.sidebarNode.children.length-1);var B=this.calculateHeight(this.mainNode,0,this.mainNode.children.length);this.alfLog("log","Sidebar height: "+H+"px");this.alfLog("log","Main content height: "+B+"px");this.alfLog("log","Viewport height: "+A+"px");var E=(H>B)?H:B;var C=(E>A)?E:A;this.alfLog("log","Setting height as (px): ",C);q.set(this.sidebarNode,"height",C+"px");q.set(this.mainNode,"width",(I-F)+"px");this.alfPublish("ALF_NODE_RESIZED",{node:this.mainNode})},endResizing:function x(z){this.resizeHandler(z);this.alfPublish(this.setPreferenceTopic,{preference:this.sidebarWidthPreferenceId,value:z.width});this.hiddenSidebarWidth=z.width},calculateHeight:function i(C,D,z){var B=0;for(var A=D;A<z;A++){B=B+parseInt(q.get(C.children[A],"height"),10)}return B},showEventListener:function e(z){this.alfLog("log","Handle show request",z);if(z&&z.selected!=null){this.render(z.selected)}},onResizeHandlerClick:function d(z){if(this.resizeHandlerNode){this.alfPublish("ALF_DOCLIST_SHOW_SIDEBAR",{selected:l.contains(this.resizeHandlerNode,"pop-out")})}},hiddenSidebarWidth:null,render:function a(z){if(z){for(var A=0;A<this.sidebarNode.children.length-1;A++){l.remove(this.sidebarNode.children[A],"share-hidden")}this.resizer.unlock(true);var B=(this.hiddenSidebarWidth)?this.hiddenSidebarWidth:this.initialSidebarWidth;this.resizer.resize(null,200,B,0,0,true);if(this.resizeHandlerNode){l.remove(this.resizeHandlerNode,"pop-out");l.add(this.resizeHandlerNode,"pop-in")}}else{this.resizer.resize(null,200,9,0,0,true);this.resizer.lock(true);if(this.resizeHandlerNode){l.add(this.resizeHandlerNode,"pop-out");l.remove(this.resizeHandlerNode,"pop-in")}for(var A=0;A<this.sidebarNode.children.length-1;A++){l.add(this.sidebarNode.children[A],"share-hidden")}}}})});