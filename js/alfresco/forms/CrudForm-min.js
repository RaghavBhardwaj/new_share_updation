define(["dojo/_base/declare","alfresco/forms/Form","dojo/_base/lang","dojo/_base/array","alfresco/buttons/AlfButton","dojo/dom-construct","dojo/dom-style","dijit/registry"],function(f,g,c,l,m,e,k,a){return f([g],{defaultData:null,postMixInProperties:function b(){this.alfSubscribe("ALF_CRUD_FORM_CREATE",c.hitch(this,"onShowCreateState"));this.alfSubscribe("ALF_CRUD_FORM_UPDATE",c.hitch(this,"onShowUpdateState"))},allWidgetsProcessed:function d(o){this.inherited(arguments);var n={};l.forEach(this._form.getChildren(),function(q,p){c.setObject(q.get("name"),q.getValue(),n)});if(this.defaultData!=null){c.mixin(n,this.defaultData)}else{this.defaultData=n}},createButtons:function j(){e.empty(this.buttonsNode);this.createButtonNode=e.create("div",null,this.buttonsNode);this.createButton=new m({pubSubScope:this.pubSubScope,label:this.message(this.createButtonLabel),additionalCssClasses:"createButton call-to-action",publishTopic:this.createButtonPublishTopic,publishPayload:this.createButtonPublishPayload,publishGlobal:this.createButtonPublishGlobal},this.createButtonNode);this.updateButtonNode=e.create("div",null,this.buttonsNode);this.updateButton=new m({pubSubScope:this.pubSubScope,label:this.message(this.updateButtonLabel),additionalCssClasses:"updateButton call-to-action",publishTopic:this.updateButtonPublishTopic,publishPayload:this.updateButtonPublishPayload,publishGlobal:this.updateButtonPublishGlobal},this.updateButtonNode);this.deleteButtonNode=e.create("div",null,this.buttonsNode);this.deleteButton=new m({pubSubScope:this.pubSubScope,label:this.message(this.deleteButtonLabel),additionalCssClasses:"deleteButton",publishTopic:this.deleteButtonPublishTopic,publishPayload:this.deleteButtonPublishPayload,publishGlobal:this.deleteButtonPublishGlobal},this.deleteButtonNode);if(this.widgetsAdditionalButtons!=null){this.additionalButtons=[];this.processWidgets(this.widgetsAdditionalButtons,this.buttonsNode)}else{this.additionalButtons=a.findWidgets(this.buttonsNode)}this.onShowCreateState(null)},onShowCreateState:function h(n){this.setValue(this.defaultData);k.set(this.createButton.domNode,"display","");k.set(this.updateButton.domNode,"display","none");k.set(this.deleteButton.domNode,"display","none");this.okButton=this.createButton;this.validate()},onShowUpdateState:function i(n){this.setValue(n);k.set(this.createButton.domNode,"display","none");k.set(this.updateButton.domNode,"display","");k.set(this.deleteButton.domNode,"display","");this.okButton=this.updateButton;this.validate()}})});