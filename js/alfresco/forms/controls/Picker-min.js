define(["alfresco/forms/controls/BaseFormControl","alfresco/core/CoreWidgetProcessing","dojo/_base/declare","dojo/_base/lang","dojo/_base/array"],function(n,a,e,b,j){return e([n,a],{itemKey:"name",getWidgetConfig:function g(){return{id:this.id+"_CONTROL",name:this.name,value:(this.value!=null)?this.value:[]}},createFormControl:function l(p,r){this.alfSubscribe("ALF_ITEMS_SELECTED",b.hitch(this,"onItemsSelected"));var q=b.clone(this.widgetsForControl);this.setModelPickedItemsConfig(b.clone(this.configForPickedItems),p.value,q);this.setModelPickerConfig(b.clone(this.configForPicker),q);this.setModelPickerWidgetValue(p.value,q);return this.processWidgets(q,this.domNode)},setModelPickedItemsConfig:function k(p,q,r){b.setObject("0.config.widgets.0.config",p,r);b.setObject("0.config.widgets.0.config.value",q,r)},setModelPickerConfig:function o(p,q){b.setObject("0.config.widgets.1.config.widgets.0.config",p,q)},getValue:function f(){var q=[];var p=this.getPickedItemsWidget().currentData.items;j.forEach(p,function(s,r){q.push(s[this.itemKey])},this);return q},setValue:function d(p){this.setModelPickerWidgetValue(p)},setModelPickerWidgetValue:function m(p,q){b.setObject("0.config.widgets.1.config.widgets.0.config.value",p,q)},updateFormDialogButton:function i(q){var p=b.getObject("verticalWidgets.formDialogButton",false,this);if(p!=null){b.setObject("widgets.0.config.value",q,p)}else{this.alfLog("warn","The button to request a form does not exist",this)}},onItemsSelected:function c(q){var p=this.getPickedItemsWidget();if(p!=null){if(q.pickedItems!=null){p.currentData.items=q.pickedItems;p.renderView();this.updateFormDialogButton(q.pickedItems)}else{this.alfLog("warn","No items provided to assign to PickedItems widget, nothing will be set",q,this)}this.validate()}else{this.alfLog("warn","PickedItems widget is not created, it is not possible to set items",this)}},getPickedItemsWidget:function h(){var p=b.getObject("verticalWidgets.pickedItemsWidget",false,this);return p},configForPickedItems:null,configForPicker:null,widgetsForControl:[{name:"alfresco/layout/VerticalWidgets",assignTo:"verticalWidgets",config:{widgets:[{name:"alfresco/pickers/PickedItems",assignTo:"pickedItemsWidget"},{name:"alfresco/buttons/AlfFormDialogButton",assignTo:"formDialogButton",config:{label:"Add",dialogTitle:"Select...",dialogConfirmationButtonTitle:"OK",dialogCancellationButtonTitle:"Cancel",formSubmissionTopic:"ALF_ITEMS_SELECTED",formSubmissionGlobal:false,formSubmissionToParent:false,additionalCssClasses:"confirmationButton",widgets:[{name:"alfresco/pickers/Picker",config:{}}]}},{name:"alfresco/buttons/AlfButton",config:{label:"Remove All",additionalCssClasses:"cancelButton",publishTopic:"ALF_ITEMS_SELECTED",publishPayload:{pickedItems:[]}}}]}}]})});