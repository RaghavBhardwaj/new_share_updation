define(["alfresco/forms/controls/BaseFormControl","dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/_base/lang","dojo/_base/array","ace/ace","ace/theme/tomorrow"],function(o,i,m,g,c,k,f,b){return i([o],{cssRequirements:[{cssFile:"./css/AceEditor.css"}],editMode:null,getWidgetConfig:function e(){return{id:this.generateUuid(),name:this.name,value:this.value}},mimeTypeMap:{"text/xml":"xml","text/javascript":"javascript","text/plain":"text","text/html":"html"},createFormControl:function h(r){var s=this.generateUuid();var q=g.create("div",{className:"alfresco-forms-controls-AceEditor",id:s},this._controlNode);var t="text";if(this.editMode!=null){t=this.editMode}else{if(this.mimeType!=null&&this.mimeTypeMap[this.mimeType]!=null){t=this.mimeTypeMap[this.mimeType]}}this.wrappedWidget=f.edit(s);this.wrappedWidget.setTheme("ace/theme/tomorrow");this.wrappedWidget.getSession().setMode("ace/mode/"+t);this.wrappedWidget.getSession().on("change",c.hitch(this,"onEditorChange"));this.wrappedWidget.getSession().on("changeAnnotation",c.hitch(this,"validate"));this.wrappedWidget.commands.bindKey("Tab",null);return this.wrappedWidget},placeWidget:function n(){},completeWidgetSetup:function l(){this.inherited(arguments);if(this.initialConfig.value!=null){this.wrappedWidget.setValue(this.initialConfig.value)}},onEditorChange:function d(){if(this.wrappedWidget!=null&&typeof this.wrappedWidget.getValue==="function"){this._oldValue=this.__oldValue;this.__oldValue=this.wrappedWidget.getValue();this.formControlValueChange(this.name,this._oldValue,this.__oldValue);this.validate()}},processValidationRules:function a(){var r=this.inherited(arguments);if(this.wrappedWidget!=null&&typeof this.wrappedWidget.getSession==="function"){var s=this.wrappedWidget.getSession().getAnnotations();var q=k.some(s,function(t){return t.type=="error"});r=r&&!q}return r},_oldValue:null,__oldValue:null,setupChangeEvents:function p(){},getValue:function j(){var q="";if(this.wrappedWidget!=null&&typeof this.wrappedWidget.getValue==="function"){q=this.wrappedWidget.getValue()}return q}})});