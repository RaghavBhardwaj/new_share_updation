define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/CoreXhr","alfresco/services/_QuickShareServiceTopicMixin","dojo/_base/lang","service/constants/Default"],function(k,e,f,c,d,i){return k([e,f,c],{constructor:function a(q){d.mixin(this,q);this.alfSubscribe(this.addQuickShareTopic,d.hitch(this,"onAddQuickShare"));this.alfSubscribe(this.removeQuickShareTopic,d.hitch(this,"onRemoveQuickShare"));this.alfSubscribe(this.getQuickShareLinkTopic,d.hitch(this,"onQuickShareLinkRequest"));this.alfSubscribe(this.getSocialLinksTopic,d.hitch(this,"onSocialLinksRequest"))},onQuickShareLinkRequest:function p(q){if(q!=null&&q.callback!=null&&q.callbackScope!=null){if(this.quickShareLink!=null){q.callback.call(q.callbackScope,this.quickShareLink)}else{this.alfLog("warn","A request was made for the QuickShare link but it has not been configured",this)}}else{this.alfLog("warn","A request was made for the QuickShare link, but either the 'callback' or 'callbackScope' attributes were not provided",q)}},onSocialLinksRequest:function h(q){if(q!=null&&q.callback!=null&&q.callbackScope!=null){if(this.socialLinks!=null){q.callback.call(q.callbackScope,this.socialLinks)}else{this.alfLog("warn","A request was made for the Social Links but they have not been configured",this)}}else{this.alfLog("warn","A request was made for the Social Links, but either the 'callback' or 'callbackScope' attributes were not provided",q)}},getAddQuickShareUrl:function o(q){return i.PROXY_URI+"api/internal/shared/share/"+q},getRemoveQuickShareUrl:function o(q){return i.PROXY_URI+"api/internal/shared/unshare/"+q},onAddQuickShare:function m(s){if(s!=null&&s.node!=null&&s.node.jsNode!=null&&s.node.jsNode.nodeRef!=null&&s.node.jsNode.nodeRef.uri!=null){var q=this.getAddQuickShareUrl(s.node.jsNode.nodeRef.uri);var r={node:s.node};this.serviceXhr({url:q,data:r,method:"POST",successCallback:this.onAddQuickShareSuccess,failureCallback:this.onAddQuickShareFailure,callbackScope:this})}},onAddQuickShareSuccess:function g(r,q){this.alfLog("log","Successfully quick shared a document",r,q);this.alfPublish(this.addQuickShareSuccessTopic,{response:r,requestConfig:q})},onAddQuickShareFailure:function l(r,q){this.alfLog("error","Failed to remove a document quick share",r,q);this.alfPublish(this.addQuickShareFailureTopic,{response:r,requestConfig:q})},onRemoveQuickShare:function j(s){if(s!=null&&s.node!=null&&(s.sharedId!=null||(s.node.jsNode!=null&&s.node.jsNode.properties!=null&&s.node.jsNode.properties["qshare:sharedId"]!=null))){var t=(s.sharedId!=null)?s.sharedId:s.node.jsNode.properties["qshare:sharedId"];var q=this.getRemoveQuickShareUrl(t);var r={node:s.node};this.serviceXhr({url:q,data:r,method:"DELETE",successCallback:this.onRemoveQuickShareSuccess,failureCallback:this.onRemoveQuickShareFailure,callbackScope:this})}},onRemoveQuickShareSuccess:function n(r,q){this.alfLog("log","Successfully removed a document quick share",r,q);this.alfPublish(this.removeQuickShareSuccessTopic,{response:r,requestConfig:q})},onRemoveQuickShareFailure:function b(r,q){this.alfLog("error","Failed to remove a document quick share",r,q);this.alfPublish(this.removeQuickShareFailureTopic,{response:r,requestConfig:q})}})});