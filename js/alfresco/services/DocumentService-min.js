define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/CoreXhr","service/constants/Default","alfresco/core/PathUtils","alfresco/core/NodeUtils","dojo/_base/lang","dojo/hash"],function(f,b,c,d,h,k,a,e){return f([b,c,h],{constructor:function j(l){a.mixin(this,l);this.alfSubscribe("ALF_RETRIEVE_SINGLE_DOCUMENT_REQUEST",a.hitch(this,"onRetrieveSingleDocumentRequest"));this.alfSubscribe("ALF_RETRIEVE_DOCUMENTS_REQUEST",a.hitch(this,"onRetrieveDocumentsRequest"))},onRetrieveSingleDocumentRequest:function g(r){if(r==null||r.nodeRef==null){this.alfLog("warn","A request was made to retrieve the details of a document but no 'nodeRef' attribute was provided",r,this)}else{var q=k.processNodeRef(r.nodeRef);targetNode=r.nodeRef;targetNodeUri=q.uri;var m=(r.site!=null&&r.site!="")?"{type}/site/{site}/{container}":"{type}/node/"+targetNodeUri;if(r.filter!=null&&r.filter.filterId==="path"){var p=encodeURIComponent(r.filter.filterData).replace(/%2F/g,"/").replace(/%25/g,"%2525");m+=this.combinePaths("/",p)+"/"}var s="?view=browse&noCache="+new Date().getTime()+"&includeThumbnails=true";var l=(r.alfResponseTopic!=null)?r.alfResponseTopic:"ALF_RETRIEVE_SINGLE_DOCUMENT_REQUEST";var o=d.URL_SERVICECONTEXT+"components/documentlibrary/data/node/"+targetNodeUri+s;var n={alfTopic:l,url:o,method:"GET",callbackScope:this};this.serviceXhr(n)}},onRetrieveDocumentsRequest:function i(t){var q="alfresco://company/home",n="alfresco/company/home";if(t.nodeRef!=null&&t.nodeRef!=""){var u=k.processNodeRef(t.nodeRef);q=t.nodeRef;n=u.uri}var s=(t.site!=null&&t.site!="")?"{type}/site/{site}/{container}":"{type}/node/"+n;if(t.filter!=null&&t.filter.path!=null){var p=encodeURIComponent(t.filter.path).replace(/%2F/g,"/").replace(/%25/g,"%2525");s+=this.combinePaths("/",p)}var o=a.replace(s,{type:encodeURIComponent(t.type),site:encodeURIComponent(t.site),container:encodeURIComponent(t.container)});if(t.filter){if(t.filter.filter!=null){o+="?filter="+t.filter.filter}else{if(t.filter.tag!=null){o+="?filter=tag&filterData="+t.filter.tag}else{if(t.filter.category!=null){o+="?filter=category&filterData="+t.filter.category}else{o+="?filter=path"}}}}if(t.pageSize!=null&&t.page!=null){o+="&size="+t.pageSize+"&pos="+t.page}o+="&sortAsc="+t.sortAscending+"&sortField="+encodeURIComponent(t.sortField);if(t.site==null){if(t.libraryRoot!=null){o+="&libraryRoot="+encodeURIComponent(t.libraryRoot)}else{o+="&libraryRoot="+encodeURIComponent(q)}}o+="&view=browse&noCache="+new Date().getTime();var r=(t.alfResponseTopic!=null)?t.alfResponseTopic:"ALF_RETRIEVE_DOCUMENTS_REQUEST";var l=d.URL_SERVICECONTEXT+"components/documentlibrary/data/doclist/"+o;var m={alfTopic:r,url:l,method:"GET",callbackScope:this};this.serviceXhr(m)}})});