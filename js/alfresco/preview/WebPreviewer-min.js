define(["dojo/_base/declare","dijit/_WidgetBase","alfresco/core/Core","service/constants/Default","dojo/_base/lang","dojo/on","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/window","dojo/dom-style","dojo/sniff"],function(v,n,a,m,z,l,s,j,u,g,p,x){k=function k(D,E,A){var B=A.substring("WebPreviewer_".length);var C=Alfresco.util.ComponentManager.get(B).plugin;return C.onWebPreviewerLogging.apply(C,arguments)};c=function c(B,A){var C=A.substring("WebPreviewer_".length);var D=Alfresco.util.ComponentManager.get(C).plugin;return D.onWebPreviewerEvent.apply(D,arguments)};return v([n,a],{constructor:function i(A){z.mixin(A);this.attributes={src:null,paging:"false",disableI18nInputFix:"false",showFullScreenButton:"true",showFullWindowButton:"true"}},setAttributes:function o(A){var B=z.clone(A);z.mixin(this.attributes,B)},swfDiv:null,fullWindowMode:false,report:function q(){if(!Alfresco.util.hasRequiredFlashPlayer(9,0,124)){return this.previewManager.message("label.noFlash")}},display:function e(){var A=this.resolveUrls();this.createSwfDiv();var B="WebPreviewer_"+this.previewManager.id;var C=new YAHOO.deconcept.SWFObject(m.URL_CONTEXT+"res/components/preview/WebPreviewer.swf",B,"100%","100%","9.0.45");C.addVariable("fileName",this.previewManager.name);C.addVariable("paging",this.attributes.paging);C.addVariable("url",A.url);C.addVariable("jsCallback","Alfresco_WebPreview_WebPreviewerPlugin_onWebPreviewerEvent");C.addVariable("jsLogger","Alfresco_WebPreview_WebPreviewerPlugin_onWebPreviewerLogging");C.addVariable("i18n_actualSize",this.previewManager.message("preview.actualSize"));C.addVariable("i18n_fitPage",this.previewManager.message("preview.fitPage"));C.addVariable("i18n_fitWidth",this.previewManager.message("preview.fitWidth"));C.addVariable("i18n_fitHeight",this.previewManager.message("preview.fitHeight"));C.addVariable("i18n_fullscreen",this.previewManager.message("preview.fullscreen"));C.addVariable("i18n_fullwindow",this.previewManager.message("preview.fullwindow"));C.addVariable("i18n_fullwindow_escape",this.previewManager.message("preview.fullwindowEscape"));C.addVariable("i18n_page",this.previewManager.message("preview.page"));C.addVariable("i18n_pageOf",this.previewManager.message("preview.pageOf"));C.addVariable("show_fullscreen_button",this.attributes.showFullScreenButton);C.addVariable("show_fullwindow_button",this.attributes.showFullWindowButton);C.addVariable("disable_i18n_input_fix",this.disableI18nInputFix());C.addParam("allowNetworking","all");C.addParam("allowScriptAccess","sameDomain");C.addParam("allowFullScreen","true");C.addParam("wmode","transparent");C.write(this.swfDiv);l(this.swfDiv,"mouseover",z.hitch(this,"onMouseOver",B));l(this.swfDiv,"mouseout",z.hitch(this,"onMouseOut",B));YAHOO.util.Event.addListener(window,"resize",function(){if(this.swfDiv.getStyle("height")!=="100%"){this.synchronizeSwfDivPosition()}},this,true);this.synchronizeSwfDivPosition();YAHOO.lang.later(500,this,this.synchronizeSwfDivPosition,[],true)},onMouseOver:function d(B,A){var C=s.byId(B);if(C&&typeof C.setMode==="function"){C.setMode("active")}},onMouseOut:function r(B,A){var C=s.byId(B);if(C&&typeof C.setMode==="function"){C.setMode("inactive")}},resolveUrls:function f(){return{url:this.attributes.src?this.previewManager.getThumbnailUrl(this.attributes.src):this.previewManager.getContentUrl()}},onWebPreviewerLogging:function y(B,C,A){this.alfLog(C,"WebPreviewer("+A+"): "+B)},onWebPreviewerEvent:function b(C,A){if(C.event){if(C.event.type=="onFullWindowClick"){this.fullWindowMode=true;var D=g.getBox();p.set(this.swfDiv,{left:D.x+"px",top:D.y+"px",width:D.w+"px",height:D.h+"px"})}else{if(C.event.type=="onFullWindowEscape"){this.fullWindowMode=false;this.synchronizeSwfDivPosition()}}}else{if(C.error){var B="Error";if(C.error.code){B=this.previewManager.message("error."+C.error.code)}Alfresco.util.PopupManager.displayMessage({text:B})}}},disableI18nInputFix:function h(A){return this.attributes.disableI18nInputFix},createSwfDiv:function t(){if(!this.swfDiv){var A=j.create("div",{id:this.previewManager.id+"-full-window-div",style:{position:"absolute"},className:"web-preview real"},document.body);this.swfDiv=A}},synchronizeSwfDivPosition:function w(){if(!this.fullWindowMode){var A=u.position(this.previewManager.getPreviewerElement());p.set(this.swfDiv,{left:A.x+"px",top:A.y+"px",width:A.w+"px",height:A.h+"px"})}}})});