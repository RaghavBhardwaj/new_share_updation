define(["alfresco/core/Page","alfresco/core/CoreXhr","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","alfresco/core/ObjectTypeUtils","service/constants/Default"],function(j,c,f,i,b,m,e){return f([j,c],{postCreate:function g(){this.serviceXhr({url:e.PROXY_URI+"api/people/"+e.USERNAME+"?groups=true",method:"GET",successCallback:this.userDataLoaded,failureCallback:this.userDataLoadFailure,callbackScope:this})},userDataLoaded:function d(o,n){this.alfLog("log","User data loaded",o,n);b.setObject("currentItem.user",o,this);if(o!=null&&o.groups!=null){i.forEach(o.groups,b.hitch(this,"processUserGroups"))}this.widgets=this.performPageFiltering(this.widgets);if(this.services!=null&&this.services.length!=0){this.processServices(this.services)}else{if(this.widgets!=null&&this.widgets.length!=0){this.processWidgets(this.widgets,this.containerNode)}}},processUserGroups:function a(o,n){b.setObject("currentItem.user.groups."+o.itemName,true,this)},userDataLoadFailure:function l(o,n){this.alfLog("error","It was not possible to load the current user data",o,n)},performPageFiltering:function h(o){var n=[];i.forEach(o,b.hitch(this,"filterPageWidget",n));return n},filterPageWidget:function k(p,r,q){var n=this.filterWidget(r,q,false);if(n){this.alfLog("log","Widget PASSES page filtering",r);p.push(r);var o=b.getObject("config.widgets",false,r);if(o!=null&&m.isArray(o)){r.config.widgets=this.performPageFiltering(o)}}else{this.alfLog("log","Widget FAILS page filtering",r)}}})});