define(["alfresco/core/ProcessWidgets","dojo/_base/declare","dojo/dom-construct","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dojo/_base/window","alfresco/core/PubQueue"],function(l,g,d,j,b,o,i,h){return g([l],{baseClass:"alfresco-core-Page",postMixInProperties:function a(){},postCreate:function p(){if(this.services!=null&&this.services.length!=0){this.processServices(this.services)}else{if(this.widgets!=null&&this.widgets.length!=0){this.processWidgets(this.widgets,this.containerNode)}}},onReadyPublish:function k(q){if(q!=null&&q.publishTopic!=null&&q.publishTopic!=""){this.alfLog("log","Onload publication",q);this.alfPublish(q.publishTopic,q.publishPayload)}else{this.alfLog("warn","The page was configured with an onload publication but no 'publishTopic' was provided",q,this)}},processServices:function f(s,u,q,r){var t=this;if(s){if(this.servicesToDestroy==null){this.servicesToDestroy=[]}this.serviceProcessingComplete=false;this._processedServiceCountdown=s.length;this._processedServices=[];j.forEach(s,function(w,v){this.createService(w,this._registerProcessedService,this,r)},this)}},createService:function n(s,x,q,r){var v=null,u={};if(typeof s==="string"){v=s}else{if(typeof s==="object"&&s.name!=null){v=s.name;if(typeof s.config==="object"){u=s.config}}}var w=this;var t=[v];require(t,function(z){var y=new z(u);w.servicesToDestroy.push(y);if(x){x.call((q!=null?q:w),y,r)}})},_processedServices:null,_processedServiceCountdown:null,_registerProcessedService:function e(q,r){this._processedServiceCountdown--;if(r==null||isNaN(r)){this._processedServices.push(q)}else{this._processedServices[r]=q}if(this._processedServiceCountdown==0){this.allServicesProcessed(this._processedServices);this.serviceProcessingComplete=true}},serviceProcessingComplete:false,allServicesProcessed:function m(q){this.alfLog("log","All services processed");if(this.widgets){this.processWidgets(this.widgets,this.containerNode)}},allWidgetsProcessed:function c(q){this.alfLog("log","All page widgets processed");if(this.publishOnReady!=null){j.forEach(this.publishOnReady,b.hitch(this,"onReadyPublish"))}h.getSingleton().release();this.alfPublish("ALF_WIDGETS_READY",{});o.add(this.domNode,"allWidgetsProcessed");o.add(i.body(),"aikau-reveal")}})});